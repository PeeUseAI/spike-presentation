<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SPIKE Performance Journey — Thong Thai</title>
<style>
/* ===== RESET & BASE ===== */
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body {
  width: 100%; height: 100%;
  overflow: hidden;           /* no scrollbars — we control everything */
  font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
  background: #ffffff;        /* white background */
  color: #1a1a1a;
  cursor: pointer;            /* hint that clicking advances */
  user-select: none;          /* prevent accidental text selection */
}

/* ===== SLIDE CONTAINER ===== */
.slide {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 40px 50px;
  opacity: 0;                 /* hidden by default */
  overflow-y: auto;           /* allow scrolling for tall content */
  pointer-events: none;       /* can't interact when hidden */
  transition: opacity 0.6s ease;
}
.slide.active {
  opacity: 1;
  pointer-events: auto;
}

/* ===== SLIDE COUNTER (bottom center) ===== */
#slide-counter {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 16px;
  color: #999;
  z-index: 100;
  letter-spacing: 2px;
}

/* ===== NAV HINT (bottom right) ===== */
#nav-hint {
  position: fixed;
  bottom: 24px;
  right: 40px;
  font-size: 14px;
  color: #999;
  z-index: 100;
}

/* ===== COLOR PALETTE ===== */
:root {
  --accent: #1a73e8;         /* SPIKE-style blue */
  --green: #2e7d32;
  --yellow: #e6a800;
  --red: #d32f2f;
  --bg-card: #f5f5f5;
  --bg-bar: #e0e0e0;
  --text-dim: #777;
}

/* ===== ANIMATIONS ===== */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(40px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes fadeIn {
  from { opacity: 0; }
  to   { opacity: 1; }
}
@keyframes countUp {
  from { opacity: 0; transform: scale(0.5); }
  to   { opacity: 1; transform: scale(1); }
}
@keyframes growBar {
  from { width: 0%; }
}
@keyframes pulseGlow {
  0%, 100% { box-shadow: 0 0 8px rgba(26,115,232,0.3); }
  50%      { box-shadow: 0 0 20px rgba(26,115,232,0.6); }
}
@keyframes slideInLeft {
  from { opacity: 0; transform: translateX(-60px); }
  to   { opacity: 1; transform: translateX(0); }
}
@keyframes slideInRight {
  from { opacity: 0; transform: translateX(60px); }
  to   { opacity: 1; transform: translateX(0); }
}
@keyframes drawLine {
  from { width: 0; }
  to   { width: 100%; }
}
@keyframes popIn {
  from { opacity: 0; transform: scale(0); }
  to   { opacity: 1; transform: scale(1); }
}

/* Utility: animate children one-by-one */
.stagger > * {
  opacity: 0;
  animation: fadeInUp 0.5s ease forwards;
}
/* Each child gets a delay — set via inline style or JS */

/* ===== SLIDE 1: TITLE ===== */
#slide1 {
  background: radial-gradient(ellipse at center, #eef2f7 0%, #ffffff 70%);
}
.three-stripes {
  display: flex;
  gap: 6px;
  margin-bottom: 40px;
  opacity: 0;
}
.three-stripes .stripe {
  width: 8px;
  height: 50px;
  background: #1a1a1a;
  border-radius: 2px;
  transform: skewX(-12deg);
}
.three-stripes .stripe:nth-child(1) { height: 30px; }
.three-stripes .stripe:nth-child(2) { height: 40px; }
.three-stripes .stripe:nth-child(3) { height: 50px; }
#slide1 h1 {
  font-size: 72px;
  font-weight: 700;
  letter-spacing: -1px;
  opacity: 0;
  text-align: center;
}
#slide1 h1 span { color: var(--accent); }
#slide1 .subtitle {
  font-size: 28px;
  color: var(--text-dim);
  margin-top: 16px;
  opacity: 0;
  text-align: center;
}
#slide1 .year-arrow {
  color: var(--accent);
  font-weight: 700;
}

/* ===== SLIDE 2 & 3: SCORECARD BAR CHARTS ===== */
.slide-header {
  width: 100%;
  text-align: center;
  margin-bottom: 32px;
}
.slide-header h2 {
  font-size: 44px;
  font-weight: 600;
  opacity: 0;
}
.slide-header .score-badge {
  display: inline-block;
  font-size: 56px;
  font-weight: 700;
  color: var(--accent);
  margin: 8px 16px 0 0;
  opacity: 0;
}
.slide-header .rank-badge {
  display: inline-block;
  font-size: 34px;
  font-weight: 600;
  color: var(--text-dim);
  opacity: 0;
}
.rank-change {
  display: inline-block;
  background: var(--green);
  color: #ffffff;
  border-radius: 12px;
  padding: 2px 10px;
  font-size: 18px;
  font-weight: 700;
  margin-left: 8px;
  opacity: 0;
}

.bar-chart {
  width: 100%;
  max-width: 900px;
}
/* Category label row inside bar charts */
.bar-cat-label {
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  padding: 2px 0 2px 0;
  margin-top: 6px;
  opacity: 0;
}
.bar-cat-label:first-child { margin-top: 0; }

.bar-row {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  opacity: 0;
}
.bar-label {
  width: 200px;
  min-width: 200px;
  text-align: right;
  padding-right: 16px;
  font-size: 14px;
  color: #555;
  line-height: 1.3;
}
.bar-track {
  flex: 1;
  height: 28px;
  background: var(--bg-bar);
  border-radius: 4px;
  position: relative;
  overflow: visible;
}
#chart2026 .bar-track {
  margin-right: 120px;
}
.bar-fill {
  height: 100%;
  border-radius: 4px;
  width: 0%;                  /* animated via JS */
  transition: width 1s ease, background-color 0.5s ease;
  position: relative;
}
.bar-value {
  position: absolute;
  right: -60px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 14px;
  font-weight: 600;
  color: #555;
  white-space: nowrap;
}
/* Color classes for bar fills */
.bar-red    { background: linear-gradient(90deg, #c62828, #ef5350); }
.bar-yellow { background: linear-gradient(90deg, #f9a825, #fdd835); }
.bar-green  { background: linear-gradient(90deg, #2e7d32, #66bb6a); }
.bar-blue   { background: linear-gradient(90deg, #1565c0, #42a5f5); }

/* Glow effect for improved categories */
.bar-improved .bar-fill {
  box-shadow: 0 0 12px rgba(52,168,83,0.5);
}
.bar-declined .bar-fill {
  box-shadow: 0 0 12px rgba(234,67,53,0.5);
}

/* Callout badges on slide 3 */
.callouts {
  display: flex;
  gap: 20px;
  margin-top: 24px;
  flex-wrap: wrap;
  justify-content: center;
}
.callout {
  background: var(--bg-card);
  border: 1px solid #e0e0e0;
  border-radius: 12px;
  padding: 12px 20px;
  text-align: center;
  opacity: 0;
}
.callout .label { font-size: 14px; color: var(--text-dim); margin-bottom: 4px; }
.callout .change { font-size: 24px; font-weight: 700; }
.callout .change.up { color: var(--green); }
.callout .change.down { color: var(--red); }

/* ===== SLIDE 4: WEIGHT OVERVIEW ===== */
.weight-chart {
  width: 100%;
  max-width: 750px;
  display: flex;
  flex-direction: column;
  gap: 24px;
}
.weight-row {
  display: flex;
  align-items: center;
  gap: 16px;
  opacity: 0;
}
.weight-label {
  width: 140px;
  min-width: 140px;
  font-size: 22px;
  font-weight: 600;
  text-align: right;
}
.weight-track {
  flex: 1;
  height: 44px;
  background: var(--bg-bar);
  border-radius: 6px;
  position: relative;
  overflow: hidden;
}
.weight-bar {
  height: 100%;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
}
.weight-pct {
  font-size: 20px;
  font-weight: 700;
  color: #fff;
  white-space: nowrap;
}
.weight-change-badge {
  min-width: 70px;
  text-align: center;
  font-size: 22px;
  font-weight: 700;
  padding: 4px 12px;
  border-radius: 8px;
  opacity: 0;
}
.weight-change-badge.up {
  color: var(--green);
  background: rgba(52,168,83,0.15);
}
.weight-change-badge.down {
  color: var(--red);
  background: rgba(234,67,53,0.15);
}
.weight-change-badge.same {
  color: var(--text-dim);
  background: rgba(136,136,136,0.1);
}
.weight-note {
  margin-top: 24px;
  text-align: center;
  font-size: 20px;
  color: var(--text-dim);
  opacity: 0;
}
.weight-note strong { color: var(--accent); }

/* bar colors per category */
.weight-bar-agile       { background: linear-gradient(90deg, #0288d1, #4fc3f7); }
.weight-bar-competitive { background: linear-gradient(90deg, #f9a825, #fdd835); }
.weight-bar-esg         { background: linear-gradient(90deg, #388e3c, #81c784); }
.weight-bar-quality     { background: linear-gradient(90deg, #8e24aa, #ce93d8); }
.weight-bar-competency  { background: linear-gradient(90deg, #ef6c00, #ffb74d); }

/* ===== SLIDE 5: FRAMEWORK CHANGES ===== */
#slide5 {                       /* framework detail (was slide 4) */
  padding: 24px 50px;
  justify-content: flex-start;
  padding-top: 24px;
}
#slide5 .slide-header { margin-bottom: 12px; }
#slide5 .fw-rows { gap: 2px; overflow-y: auto; max-height: calc(100vh - 220px); }
#slide5 .fw-item { padding: 5px 10px; font-size: 13px; }
#slide5 .fw-desc { font-size: 11px; }
#slide5 .fw-cat-label { font-size: 11px; padding: 2px 0; }
#slide5 .fw-row.cat-row { margin-top: 3px; }

/* Column header row */
.fw-header-row {
  display: flex;
  width: 100%;
  max-width: 1100px;
  margin-bottom: 10px;
}
.fw-col-title {
  flex: 1;
  font-size: 26px;
  font-weight: 600;
  text-align: center;
  opacity: 0;
}
.fw-header-row .fw-col-arrow { width: 50px; }

/* Container for all paired rows */
.fw-rows {
  width: 100%;
  max-width: 1100px;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* A single paired row: left | arrow | right */
.fw-row {
  display: flex;
  align-items: center;
  gap: 0;
  opacity: 0;
}
.fw-row-left, .fw-row-right {
  flex: 1;
}
.fw-row-arrow {
  width: 50px;
  text-align: center;
  font-size: 20px;
  color: var(--accent);
  flex-shrink: 0;
}

/* Category header row */
.fw-row.cat-row {
  margin-top: 6px;
}
.fw-row.cat-row:first-child { margin-top: 0; }
.fw-cat-label {
  font-size: 13px;
  font-weight: 700;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  padding: 3px 0;
}
.fw-cat-agile       { color: #0277bd; }
.fw-cat-competitive  { color: #c49000; }
.fw-cat-esg          { color: #2e7d32; }
.fw-cat-quality      { color: #8e24aa; }
.fw-cat-competency   { color: #e65100; }

/* KPI item card */
.fw-item {
  background: var(--bg-card);
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.fw-item .pts {
  font-weight: 700;
  color: var(--accent);
  min-width: 36px;
  text-align: right;
  white-space: nowrap;
}
.fw-item-left {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-width: 0;
}
.fw-desc {
  font-size: 12px;
  color: #777;
  margin-top: 2px;
  line-height: 1.2;
}

/* Empty placeholder when one side has no matching item */
.fw-empty {
  height: 44px;
}

.fw-item.highlight-new {
  border-color: var(--green);
  background: rgba(52,168,83,0.1);
}
.fw-item.highlight-changed {
  border-color: var(--yellow);
  background: rgba(251,188,4,0.08);
}
.fw-item.highlight-removed {
  border-color: var(--red);
  background: rgba(211,47,47,0.06);
  text-decoration: line-through;
  color: #999;
}

.fw-note {
  margin-top: 12px;
  text-align: center;
  font-size: 16px;
  color: var(--text-dim);
  opacity: 0;
}
.fw-note strong { color: var(--accent); }

/* structure badge */
.structure-badges {
  display: flex;
  gap: 16px;
  justify-content: center;
  margin-top: 10px;
}
.struct-badge {
  padding: 8px 20px;
  border-radius: 20px;
  font-size: 18px;
  font-weight: 600;
  opacity: 0;
}
.struct-foundation { background: rgba(26,115,232,0.2); border: 1px solid var(--accent); color: var(--accent); }
.struct-value { background: rgba(251,188,4,0.15); border: 1px solid var(--yellow); color: var(--yellow); }

/* ===== SLIDE 5: JAN 2026 ===== */
.bar-target-line {
  position: absolute;
  top: -2px;
  height: calc(100% + 4px);
  width: 2px;
  background: #333;
  border-right: 2px dashed rgba(0,0,0,0.4);
  z-index: 2;
}
.bar-target-label {
  position: absolute;
  top: -16px;
  transform: translateX(-50%);
  font-size: 10px;
  color: #777;
  white-space: nowrap;
}
.bar-pct {
  position: absolute;
  right: -120px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 11px;
  color: var(--text-dim);
  white-space: nowrap;
}
.note-badge {
  display: block;
  background: rgba(234,67,53,0.15);
  color: var(--red);
  font-size: 9px;
  padding: 1px 6px;
  border-radius: 6px;
  margin-top: 2px;
  text-align: right;
}

/* ===== SLIDE 6: ROAD TO #1 ===== */
#slide7 {
  padding: 40px 80px;
}
.gauge-section {
  display: flex;
  align-items: center;
  gap: 60px;
  margin-bottom: 32px;
}
.score-circle {
  width: 200px;
  height: 200px;
  border-radius: 50%;
  border: 8px solid var(--bg-bar);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
  opacity: 0;
}
.score-circle .number {
  font-size: 56px;
  font-weight: 700;
}
.score-circle .label-text {
  font-size: 16px;
  color: var(--text-dim);
}
.score-circle.current { border-color: var(--accent); }
.score-circle.target  { border-color: var(--green); }
.score-arrow {
  font-size: 48px;
  color: var(--accent);
  opacity: 0;
}
.gap-info {
  text-align: center;
  opacity: 0;
}
.gap-info .points {
  font-size: 64px;
  font-weight: 700;
  color: var(--green);
}
.gap-info .label-text {
  font-size: 18px;
  color: var(--text-dim);
}
.rank-goal {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 36px;
  opacity: 0;
  justify-content: center;
}
.rank-circle {
  width: 60px; height: 60px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 24px; font-weight: 700;
}
.rank-from { background: var(--bg-card); border: 2px solid #bbb; }
.rank-to   { background: rgba(52,168,83,0.2); border: 2px solid var(--green); color: var(--green); }

.gap-table {
  width: 100%;
  max-width: 700px;
  border-collapse: collapse;
}
.gap-table th {
  text-align: left;
  font-size: 16px;
  color: var(--text-dim);
  padding: 6px 12px;
  border-bottom: 1px solid #ddd;
}
.gap-table td {
  padding: 8px 12px;
  font-size: 17px;
  border-bottom: 1px solid #eee;
}
.gap-table .plus {
  color: var(--green);
  font-weight: 700;
  font-size: 20px;
}
.gap-table tr { opacity: 0; }

/* ===== SLIDE 7: SUMMARY / TIMELINE ===== */
#slide8 {
  background: radial-gradient(ellipse at center, #eef2f7 0%, #ffffff 70%);
}
.timeline {
  display: flex;
  align-items: center;
  gap: 0;
  margin-bottom: 48px;
  position: relative;
}
.timeline-node {
  display: flex;
  flex-direction: column;
  align-items: center;
  opacity: 0;
  z-index: 2;
}
.timeline-node .year {
  font-size: 22px;
  color: var(--text-dim);
  margin-bottom: 8px;
}
.timeline-node .circle {
  width: 80px; height: 80px;
  border-radius: 50%;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  font-size: 28px; font-weight: 700;
  border: 3px solid;
}
.timeline-node .rank {
  font-size: 14px;
  color: var(--text-dim);
  margin-top: 8px;
}
.timeline-node:nth-child(1) .circle { border-color: var(--red); color: var(--red); }
.timeline-node:nth-child(3) .circle { border-color: var(--yellow); color: var(--yellow); }
.timeline-node:nth-child(5) .circle { border-color: var(--green); color: var(--green); }

.timeline-line {
  width: 120px;
  height: 3px;
  background: #ddd;
  position: relative;
  overflow: hidden;
  z-index: 1;
}
.timeline-line .fill {
  height: 100%;
  width: 0%;
  background: var(--accent);
  transition: width 0.8s ease;
}

.key-message {
  font-size: 44px;
  font-weight: 700;
  text-align: center;
  opacity: 0;
}
.key-message span { color: var(--accent); }
.closing-sub {
  font-size: 22px;
  color: var(--text-dim);
  margin-top: 12px;
  opacity: 0;
  text-align: center;
}

/* ===== KPI CATEGORY HEADER SLIDE ===== */
.kpi-cat-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
}
.kpi-cat-name {
  font-size: 60px;
  font-weight: 700;
  opacity: 0;
}
.kpi-cat-pts {
  font-size: 28px;
  color: var(--text-dim);
  opacity: 0;
}
.kpi-cat-list {
  list-style: none;
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 16px;
}
.kpi-cat-list li {
  background: var(--bg-card);
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  padding: 10px 20px;
  font-size: 18px;
  opacity: 0;
}

/* ===== KPI DATA SLIDE ===== */
.kpi-data-slide {
  width: 100%;
  max-width: 1200px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  align-items: stretch;
}
/* Top bar: category badge + title + lead */
.kpi-top-bar {
  display: flex;
  align-items: center;
  gap: 12px;
  opacity: 0;
}
.kpi-cat-badge {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  padding: 3px 10px;
  border-radius: 4px;
  white-space: nowrap;
}
.kpi-title {
  font-size: 26px;
  font-weight: 700;
  flex: 1;
}
.kpi-lead {
  font-size: 13px;
  color: var(--text-dim);
  white-space: nowrap;
}
/* Two-column body */
.kpi-body {
  display: flex;
  gap: 20px;
  flex: 1;
  min-height: 0;
}
.kpi-left {
  flex: 3;
  display: flex;
  flex-direction: column;
  gap: 10px;
  opacity: 0;
  min-height: 0;
  overflow-y: auto;
}
.kpi-right {
  flex: 2;
  display: flex;
  flex-direction: column;
  gap: 10px;
  opacity: 0;
  min-height: 0;
  overflow-y: auto;
}
/* SVG chart container */
.kpi-chart-card {
  background: var(--bg-card);
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  padding: 12px;
}
.kpi-chart-card svg {
  width: 100%;
  height: auto;
}
.kpi-desc {
  font-size: 13px;
  color: #555;
  line-height: 1.4;
}
.kpi-desc strong { color: #1a1a1a; }
/* Score display */
.kpi-score-display {
  background: var(--bg-card);
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  padding: 12px;
  text-align: center;
  opacity: 0;
}
.kpi-score-big {
  font-size: 42px;
  font-weight: 700;
}
.kpi-score-max {
  font-size: 20px;
  color: var(--text-dim);
}
.kpi-score-label {
  font-size: 13px;
  color: var(--text-dim);
  margin-top: 2px;
}
/* Rolling percentage badges */
.kpi-pct-row {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-top: 6px;
}
.kpi-pct-badge {
  background: rgba(0,0,0,0.04);
  border-radius: 6px;
  padding: 4px 10px;
  text-align: center;
  font-size: 13px;
}
.kpi-pct-badge .val {
  font-size: 22px;
  font-weight: 700;
  display: block;
}
/* Scoring criteria table */
.kpi-scoring-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
}
.kpi-scoring-table th {
  text-align: left;
  color: var(--text-dim);
  padding: 3px 6px;
  border-bottom: 1px solid #ddd;
  font-weight: 600;
}
.kpi-scoring-table td {
  padding: 3px 6px;
  border-bottom: 1px solid #eee;
}
.kpi-scoring-table tr.active-range {
  background: rgba(26,115,232,0.15);
  border-radius: 4px;
}
.kpi-scoring-table .pts-col {
  text-align: right;
  font-weight: 700;
  color: var(--accent);
}

/* ===== KPI LEARNING SLIDE ===== */
.kpi-learning-slide {
  width: 100%;
  max-width: 1200px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 14px;
}
.kpi-learn-top {
  display: flex;
  align-items: center;
  gap: 16px;
  opacity: 0;
}
/* Score circles for learning slide */
.kpi-circle {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  border: 5px solid var(--bg-bar);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  opacity: 0;
}
.kpi-circle .num {
  font-size: 30px;
  font-weight: 700;
}
.kpi-circle .lbl {
  font-size: 11px;
  color: var(--text-dim);
}
.kpi-circle.prev { border-color: var(--text-dim); }
.kpi-circle.next { border-color: var(--green); }
.kpi-learn-arrow {
  font-size: 32px;
  color: var(--accent);
  opacity: 0;
}
/* Two-card layout */
.kpi-cards {
  display: flex;
  gap: 16px;
  width: 100%;
  flex: 1;
  min-height: 0;
}
.kpi-card {
  flex: 1;
  background: var(--bg-card);
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  padding: 14px 18px;
  opacity: 0;
  overflow-y: auto;
  min-height: 0;
}
.kpi-card h4 {
  font-size: 15px;
  font-weight: 700;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.kpi-card.learning h4 { color: var(--yellow); }
.kpi-card.plan h4 { color: var(--green); }
.kpi-card ul {
  list-style: none;
  padding: 0;
}
.kpi-card li {
  font-size: 13px;
  color: #444;
  line-height: 1.5;
  padding-left: 14px;
  position: relative;
  margin-bottom: 4px;
}
.kpi-card li::before {
  content: '•';
  position: absolute;
  left: 0;
  color: var(--text-dim);
}

/* ===== KPI DATA TABLE (monthly data, factory data) ===== */
.kpi-data-table-wrap {
  width: 100%;
  overflow-x: auto;                /* horizontal scroll for wide tables */
  margin-top: 8px;
}
.kpi-data-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
  white-space: nowrap;
}
.kpi-data-table th {
  background: #e8e8e8;
  color: var(--text-dim);
  padding: 6px 8px;
  text-align: right;
  font-weight: 600;
  border-bottom: 1px solid #ccc;
  position: sticky;
  top: 0;
}
.kpi-data-table th:first-child {
  text-align: left;
  position: sticky;
  left: 0;
  background: #e8e8e8;
  z-index: 2;
}
.kpi-data-table td {
  padding: 5px 8px;
  text-align: right;
  border-bottom: 1px solid #eee;
  color: #444;
}
.kpi-data-table td:first-child {
  text-align: left;
  font-weight: 600;
  color: #555;
  position: sticky;
  left: 0;
  background: var(--bg-card);
  z-index: 1;
}
.kpi-data-table tr.highlight-row td {
  color: var(--accent);
  font-weight: 700;
  border-top: 1px solid var(--accent);
}
.kpi-data-table .table-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-dim);
  margin-bottom: 4px;
  margin-top: 12px;
}

/* ===== KPI EXTRA SLIDE TYPES ===== */
/* Key Success slide */
.kpi-extra-slide {
  width: 100%;
  max-width: 1200px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.kpi-extra-title {
  font-size: 24px;
  font-weight: 700;
  opacity: 0;
}
.kpi-success-grid {
  display: flex;
  gap: 24px;
  width: 100%;
}
.kpi-success-card {
  flex: 1;
  background: var(--bg-card);
  border: 1px solid #e0e0e0;
  border-radius: 12px;
  padding: 20px 24px;
  opacity: 0;
}
.kpi-success-card h4 {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 12px;
}
.kpi-success-card.achievements h4 { color: var(--green); }
.kpi-success-card.support h4 { color: var(--accent); }
.kpi-success-card ul {
  list-style: none;
  padding: 0;
}
.kpi-success-card li {
  font-size: 16px;
  color: #444;
  line-height: 1.6;
  padding-left: 16px;
  position: relative;
  margin-bottom: 6px;
}
.kpi-success-card li::before {
  content: '•';
  position: absolute;
  left: 0;
  color: var(--text-dim);
}

/* Strategy / Framework slide — multi-column card grid */
.kpi-pillar-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  width: 100%;
}
.kpi-pillar-card {
  background: var(--bg-card);
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  padding: 16px 20px;
  opacity: 0;
}
.kpi-pillar-card h4 {
  font-size: 17px;
  font-weight: 700;
  margin-bottom: 8px;
  color: var(--accent);
}
.kpi-pillar-card li {
  font-size: 14px;
  color: #444;
  line-height: 1.5;
  margin-bottom: 4px;
  padding-left: 12px;
  position: relative;
  list-style: none;
}
.kpi-pillar-card li::before {
  content: '•';
  position: absolute;
  left: 0;
  color: var(--text-dim);
  font-size: 10px;
}

/* Comparison / highlight-lowlight slide */
.kpi-hl-grid {
  display: flex;
  gap: 24px;
  width: 100%;
}
.kpi-hl-card {
  flex: 1;
  background: var(--bg-card);
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  padding: 16px 20px;
  opacity: 0;
}
.kpi-hl-card h4 { font-size: 17px; font-weight: 700; margin-bottom: 8px; }
.kpi-hl-card.highlight h4 { color: var(--green); }
.kpi-hl-card.lowlight h4 { color: var(--red); }
.kpi-hl-card li {
  font-size: 14px;
  color: #444;
  line-height: 1.5;
  margin-bottom: 4px;
  padding-left: 12px;
  position: relative;
  list-style: none;
}
.kpi-hl-card li::before {
  content: '•';
  position: absolute;
  left: 0;
  color: var(--text-dim);
}

/* Dual scoring table label */
.kpi-scoring-label {
  font-size: 12px;
  font-weight: 700;
  color: var(--text-dim);
  margin-top: 4px;
  margin-bottom: 1px;
}

/* ===== EVALUATING NOTE (for criteria-only KPIs) ===== */
.kpi-evaluating-note {
  background: rgba(230,168,0,0.08);
  border: 1px solid rgba(230,168,0,0.3);
  border-radius: 6px;
  padding: 6px 12px;
  font-size: 12px;
  color: #b38600;
  text-align: center;
  margin-top: 4px;
}

/* ===== RESPONSIVE (smaller screens) ===== */
@media (max-width: 1024px) {
  .slide { padding: 30px 30px; }
  #slide1 h1 { font-size: 42px; }
  .bar-label { width: 130px; min-width: 130px; font-size: 11px; }
  .fw-row-arrow { width: 30px; font-size: 16px; }
  .fw-header-row .fw-col-arrow { width: 30px; }
  .gauge-section { flex-direction: column; gap: 20px; }
}
</style>
</head>
<body>

<!-- ========== SLIDE 1: TITLE ========== -->
<div class="slide active" id="slide1">
  <!-- Logo row -->
  <div style="display:flex;align-items:center;gap:24px;margin-bottom:32px;opacity:0" id="logo-row">
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAABBCAYAAABo3gIBAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAIdUAACHVAQSctJ0AAAkZSURBVHhe3Zt9VJPXHcezdn+6s56zs+50YLFTprNYN16SjLphOzfPdAWSqG1da227allfttmurj3sUO3pWm1rW8ZsLUwwL4AULcjxZQG0tOqQooiASFVAkJckkACBkPe7e+lPifjLzZOQRLLPOd+/uL/7fL+XPM9z73OfRxQuvpec9x2JTL1dKlcVSeWaQ2KFyvrzVRqCSSpT2cQK9WHWViJXvTOf1kI3kU1imlIhVajHpHK1Cwvuj1gfrK+kdNUa6D4ykKbvSZHIlANYqGAqUVYwLE3XpMBhZx4SmebvUpnShpkPpehpaJfI97wJNm49CSt3r2A/ZcxsWCVTWeJT81eCrfBzn0x5J70w9qDmwqxfPFxIHn7hAFn38iGy41+1Br1+9C6wGR4SZHtex4yFWsmrNeQvW6pJbnEjydvbSLquDhOXy0UwTCZrNtgNLWK55hxmNtja8OoRUnumh7S1D5LefjPE9A+Hw9kCtoPPwpScWRKF2oSZD0TL139K0jZ+Rp586SCpa+iFCMHHbndaOjpMd0CM4JDwu/wFYnrRwoL5Uuof9pF3c+smVHOyi9hsTrAaPuig2Pr6zHEQZ3qwiyedWQ5jYT3FgheVtZBTZ3vJ2fM6em67wc7MgJ4+1gudpnsgVqCQb10LvGRNIUl5tIg88Pu9NPh5YrU64FCRRVZW1rchnP/kq885TEPj0FXkwu5GVSc6ifZ4J/nja4fdEM8/dAPmA9BfxKDXm0lOfj3J3PElefH1KpLscUp7ii4a90FMYVy8aHye3t9n1kXAg9FRG8nefZosXVtMT+Nicv/qQjS4N0kVKrc4Tfk0xOXT3KybZbc7wn8r8IDdiRpadKSusY9k531Flq8rQYNNR2KZ0smmEhDbO/oB82fgK+woni1DzYdK4nRNMcTGaW3tXwTegg67qPkCMx1qLVYU3Avxb2ZkxGIFb37BLjddPcMT0+zKmg7yKF1oYQfnMTxiRWtCLforGYf4N0I93faNNe84nS7S2jZA8krOTeixFyu8Xskx8fg3XbBhNeGQaHXJ7TAMkxgMIzcsKNouDZJNW6vJE3RJveq5cnolxzsTqpeyqqFnnLc+qkXrwiG6LLkCwzAJ1jCY6ukdgeg4f9pShdaFSzAM35AoK0jFGgVTYxY7RMfBasKpBJlyHQyHSCRVqM9ijYIpuriC6DhYTTglUaibYDjYA2KlE2sUTPHQftGO1oRTbPY6MRhxD+X+AGsQTG342xGIjlNWeRGtC6fYTeOvmZ/HiiRyzQ6sQTB19OQViI7z1j//i9aFQkto8OcztUT7ZQeppKvfbjp/uobF6vhYJJUrP8EKg6kzzf1wSJyUR4rQuulq4+YjpLFZR8atDmKzO4nbzV+vOhyu3SKpTHMM6yyY6jeMwiFvhk32sBohUmSUkeeyKsmmN6pJ0wU99Bg4/TpzD73DqNzYwYIpHlf7RtAaT618qpQUHjhPSg5dIMdPdfv8T0+HkE/IUjfsh0PhtLUbJ9vS4MX7W0iffpQYjBb2cBhahY+QD0hBaRMcKjIIyYCwrcVtdG3CdtgaW3VwqMhgWgOS8kghyXqnhly4PEgudhiJ0WSBbiMTC11ecAeETVZWPF06scP2xgcnSEenCUojE3pbJYP0n8buemWHvyar6F1qaubrA5LxqnZid+3D/HrS2TU04zaa/KW+oZd8eqiNFFe0kjUZ5YKf24h0+rEW6OP/AiykUCWlqxpFLpcrF/qacbD5BtsAYLuE7fR0Za9C8OYgNrsDDSpUEpkqT2Q2W3dCf7eUft0oqYbdtVfePEZ+Se9UUw0ve2wvtMYxGMduqvFHkjRVjqhCeykW+gs7m7fX+PVoctuuWqjEudIzhNYJ1eLl+XMmHgE47bagX0HdDv4TMgZmiqfsPaehEifzH5+jdUI1MRgMp8PRDH0Kxj0+Suyn64n9i+PEkptNjPGJZDB63nUZk+6Hljg6Oj3HTPF05lwfVONgNUJFrx/NMBwiUXdV1Wbo8yZcVguxHa0go5lbJmQU//SG4N5kSl4KPeA889p/UGM8sXkED6xGqBKm7vWyq7e1uoKYHlpB/7tLiDHuZ2hQoRov3wc2cfwdkAfWFkOld7A6oYJhmKTz7p8YsGCByhe/fty/Dez1Lx+ESu9gdUIkTldehWGYhA7RbViwQOULzBhPL2RVQiXO2zmBP4ZEd+4YPVHz7Vi4QMSjvcOEGuPpYNUlqMZJ3bgfrfMlr3u7jLY5sYuxcH4r5sdgE+djTQNqjidf/PapUrTOl+IUBfdBfJyOmEUVaEg/ZN62BWzibN91CjXHky8C2XuWyNX7IbZ3mr+/cJY+ap4TCypULqMRbOKw99Ixg960dG0RVHoHq+OJXkidyallwj5Mal6QsMkQPc+NhRUi19AQ2MTBDPK07HH+GqZc+zVa503swXq8XJMBcYXRPjeuGgsrRG6X94fDeoP/C7CdBfwp+yvbatA6bxLL1Ychpn/0B/IrieGvFavoahYzyZMvMjK1aJ03QTz/KRGJbkdDczSy+VmwiVMewD6uLx6ks1isDpMoZRpvMjNa5y+eY4iKtWLhMdmO1YBNnD9vrUaN8sSDrW+wmqliHy/cm1Y0G2JNj0vRC+L0UXNt2ABMlb3uJFjFwcz6Eo+Gpn60xlNSucYen6ZeBHGCQ0dMzB362bEWbBA85bJ5f5GRbThjhnna+t5xqMbJL21C666JLuvNCct2fRdiBB991I9asIG4Jh6d3f4/0Wq7PAjVODvyvkLrmOgvI3RfVHnSPXt+DjYYw0+uB5s4bDMLM87TlauT729g/MbLqjkpTf0B2A0PnXcvuKsvOtboOSBj730INnHYzx8zzxPvuxy2dzS1PT1F9PEyVXi/yvSkbW7SM7roeQ42IBblbrCKM9W8EPHo6h6+3k6iUFuTFKonwNat5/I9C9+393dzH1Z7BhUi9iIMj9qGXvaLcCamK98FGzMPt8PxK8c4/lIqFpqnMrpG8YbFYrXVN/c9CIeNDOrqerY6nc5xKjd7ZouF5umoxxcUTqfLzfqqr+99G7qPbHbuPHFnUqpql1ShLJYolDVSmdqODQIT+xtr09UzvFc3MKrWalt/CN2EGJHof+TJjUi51jVTAAAAAElFTkSuQmCC" alt="Thongthai" style="height:50px">
    <span style="font-size:24px;color:#ccc;font-weight:300">&times;</span>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAANCAMAAADVJm2BAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD5UExURQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAABAAAAwAAAwAAAwMDAwAAAwAAAwAAAAAAAAAAAAMDAwICAgICAgICAgAAAAICAwICAwICAwICAwICAwICAwEBAQEBAQEBAQEBAQEBAQEBAQEBBAEBAQEBAwICAgICAgICAgICAgEBBAEBBAICAwICAwICAwICAwICAwMDBAICAwICAwMDBAMDBAMDBAICAwMDBAMDBAMDBAMDBB4tu4EAAABSdFJOUwABBAkODxITFRoeHyAhJCUmJywtLzAxNDc6Oz1AQ0NIS0xPT1FUVVZYYGhtdpGSnJ6ipamsrba6vL29v8TO0NHU19js7e/x9fX29/f4+vz8/f7RbWJJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABFUlEQVQoU52Rh06DMQyEzSwpqz9QNpRNgbI3pey9ufd/GM5DvyohFYlIie8cf46SyO8BTB4DYehSqD/G/7GVWi1MC+wS2Fm0/rPAe39+2jLw1uPYKXDADiKFV2BLoRnEEHkJ5VgYYp2hIJsRbXdwyPQFcF88ozLsEWgUG3RJS8ZLVgL0KTEhD8bqDmfFpWHAGM0IsXpzybNKNfMa1i0XmcDCpU/sqRpm5lvP5DWZXtLcWgvsA9uqRjVzZdyT3Po2NecqVXeOlb02nXjJF0O1GrW6TE1rC7kG6tkuVWA4zI642pMslLlockPkTrGmDwjhWO6S9IaC7Hsc4JltvOe5f3fGFD/YMZmj61JM9L1v2EekQ6l2+QEcQm9x3zw6lgAAAABJRU5ErkJggg==" alt="adidas" style="height:18px">
  </div>
  <!-- CSS-only three stripes (Adidas-inspired) -->
  <div class="three-stripes" id="stripes">
    <div class="stripe"></div>
    <div class="stripe"></div>
    <div class="stripe"></div>
  </div>
  <h1 id="title-text">SPIKE <span>Performance Journey</span></h1>
  <div class="subtitle" id="subtitle-text">
    Thong Thai &nbsp;|&nbsp; 2024 <span class="year-arrow">→</span> 2026
  </div>
</div>

<!-- ========== SLIDE 2: 2024 SCORECARD ========== -->
<div class="slide" id="slide2">
  <div class="slide-header">
    <h2 id="s2-title">2024 Full Year</h2>
    <div>
      <span class="score-badge" id="s2-score">52.5</span>
      <span class="rank-badge" id="s2-rank">Rank #12</span>
    </div>
  </div>
  <div class="bar-chart" id="chart2024">
    <!-- Bars injected by JS -->
  </div>
</div>

<!-- ========== SLIDE 3: 2025 SCORECARD ========== -->
<div class="slide" id="slide3">
  <div class="slide-header">
    <h2 id="s3-title">2025 Full Year</h2>
    <div>
      <span class="score-badge" id="s3-score">60.1</span>
      <span class="rank-badge" id="s3-rank">Rank #7</span>
      <span class="rank-change" id="s3-change">&#9650; 5 places</span>
    </div>
  </div>
  <div class="bar-chart" id="chart2025">
    <!-- Bars injected by JS -->
  </div>
  <div class="callouts" id="callouts3">
    <!-- Callout badges injected by JS -->
  </div>
</div>

<!-- ========== SLIDE 4: WEIGHT OVERVIEW ========== -->
<div class="slide" id="slide4">
  <div class="slide-header">
    <h2 id="s4-title">2026 Framework — What Changed?</h2>
  </div>
  <div class="weight-chart" id="weight-chart">
    <!-- Weight rows injected by JS -->
  </div>
  <div class="weight-note" id="weight-note">
    Total remains <strong>100 points</strong> — weights shifted toward Competency
  </div>
</div>

<!-- ========== SLIDE 5: 2026 FRAMEWORK CHANGES ========== -->
<div class="slide" id="slide5">
  <div class="slide-header">
    <h2 id="s5-title">What Changed in the 2026 Framework?</h2>
  </div>
  <!-- Column headers -->
  <div class="fw-header-row">
    <h3 class="fw-col-title" id="fw-title-left">2025</h3>
    <div class="fw-col-arrow"></div>
    <h3 class="fw-col-title" id="fw-title-right">2026</h3>
  </div>
  <!-- Paired rows injected by JS -->
  <div class="fw-rows" id="fw-rows"></div>
  <div class="structure-badges" id="struct-badges">
    <div class="struct-badge struct-foundation">Foundation — 70 pts</div>
    <div class="struct-badge struct-value">Value — 30 pts</div>
  </div>
  <div class="fw-note" id="fw-note">
    Total still <strong>100 pts</strong> — 8 KPIs across Foundation (70) + Value (30)
  </div>
</div>

<!-- ========== SLIDE 5: JANUARY 2026 ========== -->
<div class="slide" id="slide6">
  <div class="slide-header">
    <h2 id="s6-title">January 2026</h2>
    <div>
      <span class="score-badge" id="s6-score">34.9</span>
      <span class="rank-badge" id="s6-rank">Rank #16</span>
    </div>
  </div>
  <div class="bar-chart" id="chart2026">
    <!-- Bars injected by JS -->
  </div>
</div>

<!-- ========== SLIDE 6: ROAD TO #1 ========== -->
<div class="slide" id="slide7">
  <div class="slide-header">
    <h2 id="s7-title">End of Year Target</h2>
  </div>
  <div class="gauge-section">
    <div class="score-circle current" id="s7-current">
      <div class="number">34.9</div>
      <div class="label-text">January</div>
    </div>
    <div class="score-arrow" id="s7-arrow">→</div>
    <div class="score-circle target" id="s7-target">
      <div class="number">62.2</div>
      <div class="label-text">Target</div>
    </div>
    <div class="gap-info" id="s7-gap">
      <div class="points">+27.3</div>
      <div class="label-text">points needed</div>
    </div>
  </div>
  <div class="rank-goal" id="s7-rankgoal">
    <div class="rank-circle rank-from">#16</div>
    <span style="font-size:28px;color:var(--accent)">→</span>
    <div class="rank-circle rank-to">#7</div>
  </div>
  <table class="gap-table" id="gap-table">
    <thead>
      <tr style="opacity:1">
        <th>Category</th>
        <th>Current</th>
        <th>Target</th>
        <th>Gap</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows injected by JS -->
    </tbody>
  </table>
</div>

<!-- ========== SLIDE 7: SUMMARY ========== -->
<div class="slide" id="slide8">
  <div class="timeline" id="timeline">
    <div class="timeline-node">
      <div class="year">2024</div>
      <div class="circle">52.5</div>
      <div class="rank">#12</div>
    </div>
    <div class="timeline-line"><div class="fill" id="tl-fill1"></div></div>
    <div class="timeline-node">
      <div class="year">2025</div>
      <div class="circle">60.1</div>
      <div class="rank">#7</div>
    </div>
    <div class="timeline-line"><div class="fill" id="tl-fill2"></div></div>
    <div class="timeline-node">
      <div class="year">2026 Target</div>
      <div class="circle">62.2</div>
      <div class="rank">#7</div>
    </div>
  </div>
  <div class="key-message" id="key-msg">From <span>#12</span> to targeting <span>#7</span></div>
  <div class="closing-sub" id="closing-sub">+9.7 points over 3 years of continuous improvement</div>
</div>

<!-- ========== SLIDE COUNTER ========== -->
<div id="slide-counter">1 / 8</div>
<div id="nav-hint">Click or press → to advance &nbsp;|&nbsp; ← to go back</div>

<!-- ========== JAVASCRIPT ========== -->
<script>
// =============================================
// DATA
// =============================================

// 2024 scores: [category name, max points, actual score, group category]
const data2024 = [
  ['Availability',       10, 0,  'Agile'],
  ['Responsiveness',     15, 5,  null],
  ['FOB',                10, 6,  'Competitive'],
  ['ME',                 10, 7,  null],
  ['Digital',            10, 6,  null],
  ['Social Compliance',  10, 9,  'ESG'],
  ['Environmental',       5, 4,  null],
  ['Traceability',        5, 3,  null],
  ['Quality',            15, 5,  'Quality'],
  ['Product & Dev Comp', 10, 8,  'Competency'],
];

// 2025 scores: [category name, max points, actual score, change vs 2024, group category]
const data2025 = [
  ['Availability',       10,  4,  +4, 'Agile — 25%'],
  ['Responsiveness',     15,  9,  +4, null],
  ['FOB',                10,  5,  -1, 'Competitive — 25%'],
  ['ME',                 15, 12,  +5, null],
  ['Social Compliance',  10,  9,   0, 'ESG — 20%'],
  ['Environmental',       5,  4,   0, null],
  ['Traceability',        5,  5,  +2, null],
  ['Quality',            15,  3,  -2, 'Quality — 15%'],
  ['Product & Dev Comp', 15,  9,  +1, 'Competency — 15%'],
];

// 2026 January: [category name, max points, target, january score, note or null, group category]
// Using the 8 official KPIs from the 2026 framework
const data2026 = [
  ['Availability',                  10, 10,    10,    null,            'Agile — 20%'],
  ['Responsiveness',                10,  9,     9,    null,            null],
  ['FOB / Landed Cost Achievement', 15,  0,     0,    'Target TBD',   'Competitive — 15%'],
  ['Social Compliance',             10,  8.5,   0,    'Audited Q4',   'ESG — 20%'],
  ['Sourcing Sustainability',       10,  7.2,   5.85, null,            null],
  ['Quality',                       15,  8.5,   0,    'Not yet scored','Quality — 15%'],
  ['Product & Dev Competency',      20, 13,    10,    null,            'Competency — 30%'],
  ['Engineering Solutions',         10,  6,     0,    'Not yet scored', null],
];

// Gap analysis rows for slide 6: [category, current, target, gap]
const gapData = [
  ['Social Compliance',        0,     8.5,  +8.5],
  ['Quality',                  0,     8.5,  +8.5],
  ['Engineering Solutions',    0,     6,    +6.0],
  ['Product & Dev Competency', 10,   13,    +3.0],
  ['Sourcing Sustainability',  5.85,  7.2,  +1.35],
];

// Slide 4 data: category weight changes (2025 → 2026)
// [category name, 2025 weight %, 2026 weight %, CSS color class]
const weightData = [
  { name: 'Agile',       from: 25, to: 20, barCls: 'weight-bar-agile',       labelCls: 'fw-cat-agile' },
  { name: 'Competitive', from: 25, to: 15, barCls: 'weight-bar-competitive', labelCls: 'fw-cat-competitive' },
  { name: 'ESG',         from: 20, to: 20, barCls: 'weight-bar-esg',         labelCls: 'fw-cat-esg' },
  { name: 'Quality',     from: 15, to: 15, barCls: 'weight-bar-quality',     labelCls: 'fw-cat-quality' },
  { name: 'Competency',  from: 15, to: 30, barCls: 'weight-bar-competency',  labelCls: 'fw-cat-competency' },
];

// Category header data: [name, color, total points, sub-KPI names]
const categoryHeaders = [
  { name: 'Agile',      color: '#0277bd', pts: 20, badge: 'fw-cat-agile',
    kpis: ['MDP (7 pts)', 'SDP (3 pts)', 'Responsiveness (5 pts)', 'Elevated Focus Delivery (5 pts)'] },
  { name: 'Competitive', color: '#c49000', pts: 15, badge: 'fw-cat-competitive',
    kpis: ['FOB Target Achievement (5 pts)', 'Holistic Cost Contribution (5 pts)', 'Duty Benefit Optimization (5 pts)'] },
  { name: 'ESG',        color: '#2e7d32', pts: 20, badge: 'fw-cat-esg',
    kpis: ['Social Compliance (10 pts)', 'Environmental (7 pts)', 'Product Traceability (3 pts)'] },
  { name: 'Quality',    color: '#8e24aa', pts: 15, badge: 'fw-cat-quality',
    kpis: ['Q-KPI (15 pts)'] },
  { name: 'Competency', color: '#e65100', pts: 30, badge: 'fw-cat-competency',
    kpis: ['Product & Dev Competency (20 pts)', 'Engineering Solutions (10 pts)'] },
];

// All KPI detail data — each object drives one data slide (and optionally one learning slide)
// Full content sourced from "Mornitoring SPIKE 2026 TTT (Jan).pptx"
const kpiData = [
  // ===== AGILE =====
  {
    id: 'mdp',
    name: 'MDP — Management Delivery Performance',
    category: 'Agile',
    catColor: '#0277bd',
    lead: 'Apisak',
    maxPts: 7,
    currentScore: 7,
    rollingPct: 97.8,
    janPct: 98.6,
    targetPct: '91% (APP/FTW) / 94% (A&G)',
    description: 'PODD (FGR) on-time vs. Customer Request Date for bulk orders. 2026 Targets: 91% (APP/FTW), 94% (A&G).',
    scoring: [
      ['< 86%', 0], ['≥ 86%', 1], ['≥ 88%', 2], ['≥ 90%', 3],
      ['≥ 91%', 4], ['≥ 92%', 5], ['≥ 93%', 6], ['≥ 94%', 7],
    ],
    currentRange: '≥ 94%',
    // Full monthly data table from PPTX slide 6
    monthlyData: {
      headers: ['', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Total'],
      rows: [
        ['On-time Qty', '1,219,780', '1,783,410', '1,933,540', '1,682,723', '964,700', '159,542', '46,207', '20,694', '2,101', '613', '-', '-', '7,813,310'],
        ['Order Qty', '1,236,829', '1,797,837', '1,987,895', '1,696,311', '967,995', '159,542', '46,207', '20,694', '2,101', '613', '-', '-', '7,916,024'],
        ['%MDP', '98.6%', '99.2%', '97.3%', '99.2%', '99.7%', '100%', '100%', '100%', '100%', '100%', '-', '-', '98.7%'],
        ['Open FC', '-', '-', '138,938', '267,642', '709,732', '547,849', '490,653', '1,221,739', '7,757', '9', '-', '-', '3,384,319'],
        ['Proj. %', '', '', '95%', '95%', '96%', '96%', '96%', '94%', '94%', '94%', '94%', '94%', ''],
        ['MDP w/ Proj.', '98.6%', '99.2%', '97.2%', '98.8%', '98.0%', '97.3%', '96.9%', '94.4%', '95.3%', '99.9%', '100%', '100%', '97.8%'],
      ],
      highlightRow: 'Rolling MDP',
      rollRow: ['Rolling MDP', '98.6%', '99.0%', '98.2%', '98.4%', '98.3%', '98.2%', '98.2%', '97.8%', '97.8%', '97.8%', '97.8%', '97.8%', '97.8%'],
    },
    hasLearning: true,
    endYear2025: 4,
    maxPts2025: 7,
    target2026: 7,
    keyLearning: [
      'First half delay was from backlog carried over from end of 2024.',
      'Second half delay in 2025 was from material delay — back on track by end of year.',
    ],
    improvementPlan: {
      sections: [
        { header: 'Pre-Season', items: [
          'Utilisation of consolidation and EBR to utilise end of season capacity and minimize peak of each BU and Factory.',
          'Sub-Process risk assessment — Identify and create action plan for potential high fill rate of sub process.',
          'Identify styles that can be easily moved to maintain good quality and efficiency and allocate strategically to allow agile capacity shifting.',
        ]},
        { header: 'In-Season', items: [
          'Actively track the status of all POs — both materials and production — to ensure every PO is closed as committed.',
          'Review material status weekly with all relevant teams and plan at least 3 buckets ahead.',
          'Monitor risks proactively and escalate issues early to prevent delays.',
          'Streamlining process to finish order confirmation for SLT faster and information flow faster to all parties.',
          'Quick identification of overfill in upcoming months from buy plan, and plan to tackle early to allow more time for production to work.',
        ]},
      ]
    },
  },
  {
    id: 'sdp',
    name: 'SDP — Supplier Delivery Performance',
    category: 'Agile',
    catColor: '#0277bd',
    lead: 'Apisak',
    maxPts: 3,
    currentScore: 3,
    rollingPct: 99.6,
    janPct: 99.0,
    targetPct: '97%',
    description: 'PODD (FGR) on-time vs. PO Statistical Delivery Date for bulk orders. 2026 Target: 97%.',
    scoring: [
      ['< 97%', 0], ['≥ 97%', 1], ['≥ 98%', 2], ['≥ 99%', 3],
    ],
    currentRange: '≥ 99%',
    monthlyData: {
      headers: ['', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Total'],
      rows: [
        ['On-time Qty', '1,224,350', '1,787,018', '1,987,808', '1,696,311', '967,995', '159,542', '46,207', '20,694', '2,101', '613', '-', '-', '7,892,639'],
        ['Order Qty', '1,236,829', '1,797,837', '1,987,895', '1,696,311', '967,995', '159,542', '46,207', '20,694', '2,101', '613', '-', '-', '7,916,024'],
        ['%SDP', '99.0%', '99.4%', '100%', '100%', '100%', '100%', '100%', '100%', '100%', '100%', '-', '-', '99.7%'],
        ['SDP w/ Proj.', '99.0%', '99.4%', '100%', '100%', '99.7%', '100%', '100%', '99.1%', '99.2%', '100%', '100%', '100%', '99.6%'],
      ],
      highlightRow: 'Rolling SDP',
      rollRow: ['Rolling SDP', '99.0%', '99.2%', '99.5%', '99.7%', '99.7%', '99.7%', '99.7%', '99.6%', '99.6%', '99.6%', '99.6%', '99.6%', '99.6%'],
    },
    hasLearning: true,
    endYear2025: 0,
    maxPts2025: 3,
    target2026: 3,
    keyLearning: [
      'Focused too heavily on MDP, resulting in insufficient attention to SDP.',
      'Confirming remaining orders with production lead time of less than 21 days caused limited manufacturing time. If any issues occurred during production, there was not enough buffer to recover.',
    ],
    improvementPlan: [
      'Refocus on SDP to ensure better balance. If SDP is delayed, further follow-up is required to determine whether MDP is also delayed and how the issue can be resolved.',
      'Adjust the order confirmation process to be more realistic regarding the fabric delivery and sewing plan.',
    ],
  },
  {
    id: 'responsiveness',
    name: 'Responsiveness',
    category: 'Agile',
    catColor: '#0277bd',
    lead: 'Apisak',
    maxPts: 5,
    currentScore: 4,
    rollingPct: 27.2,
    janPct: 34.0,
    targetPct: '≥ 30%',
    description: 'Shipped Volumes from Responsiveness Programs as % of Total Shipped Volume. Programs: Rapid Creation, In Season Creation, Planned Responsiveness/React, NOS/SLT, Customization, CHASE & Components.',
    scoring: [
      ['0% (Core)', 'N/A'], ['< 1%', 0], ['≥ 1%', 1], ['≥ 5%', 2],
      ['≥ 15%', 3], ['≥ 20%', 4], ['≥ 30%', 5],
    ],
    currentRange: '≥ 20%',
    monthlyData: {
      headers: ['', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Total'],
      rows: [
        ['Resp. Order Qty', '256,765', '117,583', '287,834', '225,964', '159,663', '19,033', '9,140', '-', '-', '-', '-', '-', '1,075,982'],
        ['MI', '163,977', '112,293', '354,238', '104,955', '112,313', '23,787', '2,937', '302', '-', '613', '-', '-', '875,415'],
        ['Customize', '-', '-', '50,000', '100,000', '134,696', '136,097', '115,744', '82,229', '-', '-', '-', '-', '618,766'],
        ['NOS/SLT', '', '', '88,930', '66,621', '159,655', '132,340', '44,406', '10,697', '-', '-', '-', '-', '502,649'],
        ['Total Resp.', '420,742', '229,876', '781,002', '497,540', '566,785', '311,257', '172,227', '93,228', '-', '613', '-', '-', '3,073,270'],
        ['Total Qty (order+FC)', '1,236,829', '1,797,837', '2,126,833', '1,963,953', '1,677,727', '707,391', '536,860', '1,242,433', '9,858', '622', '-', '-', '11,300,343'],
        ['%Resp. w/ Proj.', '34.0%', '12.8%', '36.7%', '25.3%', '33.8%', '44.0%', '32.1%', '7.5%', '0.0%', '98.6%', '100%', '100%', '27.2%'],
      ],
      highlightRow: 'Rolling Resp.',
      rollRow: ['Rolling Resp.', '34.0%', '21.4%', '27.7%', '27.1%', '28.4%', '29.5%', '29.7%', '27.2%', '27.2%', '27.2%', '27.2%', '27.2%', '27.2%'],
    },
    hasLearning: false,
  },
  {
    id: 'efd',
    name: 'EFD — Elevated Focus Delivery',
    category: 'Agile',
    catColor: '#0277bd',
    lead: 'Atipat / Kanyakorn',
    maxPts: 5,
    currentScore: 5,
    rollingPct: 99.3,
    janPct: 99.3,
    targetPct: 'MDP: 95% / Samples: 99%',
    description: 'MDP: PODD on-time vs. Customer Request Date for priority product/ranges (Priority Products, Customization). Target: 95%.\nSamples: GPS system — GTM (GS), Presell/SMS (SO), Monthly Special (NS). Target: 99%.',
    // Two separate scoring tables — MDP (3 pts) and Sample MDP (2 pts)
    scoring: [
      ['< 95%', 0], ['≥ 95%', 1], ['≥ 97%', 2], ['≥ 99%', 3],
    ],
    scoringLabel: 'MDP EFD Scoring (3 pts)',
    scoringSample: [
      ['< 99%', 0], ['≥ 99%', 1], ['≥ 99.5%', 2],
    ],
    scoringSampleLabel: 'Sample MDP Scoring (2 pts)',
    currentRange: '≥ 99%',
    monthlyData: {
      headers: ['KPI', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
      rows: [
        ['MDP EFD %', '99.3%', '', '', '', '', '', '', '', '', '', '', ''],
        ['MDP Score', '3', '', '', '', '', '', '', '', '', '', '', ''],
        ['Sample MDP %', '100%', '', '', '', '', '', '', '', '', '', '', ''],
        ['Sample Score', '2', '', '', '', '', '', '', '', '', '', '', ''],
      ],
      highlightRow: 'Total Score',
      rollRow: ['Total Score', '5', '', '', '', '', '', '', '', '', '', '', ''],
    },
    hasLearning: true,
    endYear2025: 3,
    maxPts2025: 5,
    target2026: 5,
    keyLearning: [
      'Issue with Order Creation that didn\'t flag Priority and no one rechecked.',
      'Lack of awareness and attention to priority products and all other Order classification.',
    ],
    improvementPlan: [
      'Review on KPI of these orders weekly and seek for improvement.',
      'Clearly identify Priority Product POs in all reports and all tracking activities.',
      'Establish clear guidelines for all teams: Priority Products and SPOMA must not be delayed, and reinforce this principle consistently.',
    ],
  },
  // ===== COMPETITIVE =====
  {
    id: 'competitive',
    name: 'FOB / Landed Cost Achievement',
    category: 'Competitive',
    catColor: '#c49000',
    lead: 'Costing Team',
    maxPts: 15,
    currentScore: null,              // not yet scored — still evaluating
    rollingPct: null,
    janPct: null,
    targetPct: 'TBD — Still evaluating',
    description: 'Measures supplier cost competitiveness across 3 areas: FOB Target Achievement, Holistic Cost Contribution, and Duty Benefit Optimization. Total 15 points.',
    scoring: [],                     // empty — we use componentScoring instead
    scoringIsComponents: true,
    componentScoring: [
      {
        label: 'FOB Target Achievement (Max 5 pts)',
        headers: ['Actual vs. Target FOB', 'SPIKE Points'],
        rows: [
          ['> 0%', '0'],
          ['≥ -1%', '1'],
          ['≥ -2%', '2'],
          ['≥ -3%', '3'],
          ['≥ -4.5%', '4'],
          ['< -4.5%', '5'],
        ]
      },
      {
        label: 'Holistic Cost Contribution (Max 5 pts)',
        headers: ['Criteria', 'Points'],
        rows: [
          ['Discretionary award by adidas Costing team', '0–5'],
        ]
      },
      {
        label: 'Duty Benefit Optimization (Max 5 pts)',
        headers: ['Lowest Duty Position', 'SPIKE Points'],
        rows: [
          ['≤ 1 market', '1'],
          ['> 1 and < 2 markets', '2'],
          ['≥ 2 and < 2.5 markets', '3'],
          ['≥ 2.5 and < 3 markets', '4'],
          ['≥ 3 markets', '5'],
        ],
        explanation: {
          title: 'How Duty Benefit Optimization Works',
          text: 'This KPI measures how well the supplier utilizes Free Trade Agreements (FTAs) to achieve the lowest possible import duty rates for adidas products. A "market" counts when a destination country receives products at a reduced duty rate through an applicable trade agreement (e.g., FTA, GSP, or preferential tariff). The more markets where duty savings are achieved, the higher the score.',
          example: {
            title: 'Example Calculation',
            steps: [
              'Thong Thai ships to the EU using Thailand-EU FTA → duty reduced from 12% to 0% (1st market with duty benefit)',
              'Also ships to Japan using RCEP agreement → duty reduced from 9% to 0% (2nd market)',
              'Also ships to South Korea using ASEAN-Korea FTA → duty reduced from 13% to 0% (3rd market)',
              'Total = 3 markets with lowest duty position → Score: ≥ 3 markets = 5 SPIKE points (maximum)',
            ],
          },
        },
      },
    ],
    currentRange: 'Not yet scored',
    evaluatingNote: 'This KPI is still being evaluated. Only the measurement criteria are shown.',
    hasLearning: false,              // no learning — still evaluating
  },
  // ===== ESG =====
  {
    id: 'social-compliance',
    name: 'Social Compliance (SI-KPI)',
    category: 'ESG',
    catColor: '#2e7d32',
    lead: 'Natchamai',
    maxPts: 10,
    currentScore: 0,
    rollingPct: null,
    janPct: null,
    targetPct: '8.5 / 10 pts',
    description: 'Social Impact KPI (SI-KPI) — transitioned from S-KPI. All active facilities measured in one of two routes:\n1. Existing SI-KPI facilities (Route 1)\n2. Other facilities measured by Compliance Scorecard / CSC (Route 2)\n\nSI-KPI will only be audited in Q4. At 2026 SPIKE mid-year reporting cut-off, SI-KPI SPIKE result will be reported as N/A.',
    // Route 1: SI-KPI scoring
    scoringLabel: 'Route 1: SI-KPI Scoring',
    scoring: [
      ['< 60%', 0], ['≥ 60%', 1], ['≥ 64%', 2], ['≥ 68%', 3], ['≥ 72%', 4],
      ['≥ 76%', 5], ['≥ 80%', 6], ['≥ 84%', 7], ['≥ 88%', 8], ['≥ 92%', 9], ['≥ 95%', 10],
    ],
    // Route 2: Compliance Scorecard (CSC) scoring
    scoringCSC: [
      ['< 70%', 0], ['≥ 70%', 1], ['≥ 75%', 2], ['≥ 80%', 3], ['≥ 85%', 4],
      ['≥ 88%', 5], ['≥ 90%', 6], ['≥ 92%', 7], ['≥ 94%', 8], ['≥ 96%', 9], ['100%', 10],
    ],
    scoringCSCLabel: 'Route 2: Compliance Scorecard (CSC)',
    // SI-KPI performance levels
    scoreScale: [
      ['95% ≤ X ≤ 100%', 'Best in Class'],
      ['80% ≤ X < 95%', 'High Performance'],
      ['60% ≤ X < 80%', 'Basic Expectation'],
      ['30% ≤ X < 60%', 'Low Performance'],
      ['0% ≤ X < 30%', 'High Risk'],
    ],
    currentRange: 'Audited Q4',
    hasLearning: true,
    endYear2025: 9.25,
    maxPts2025: 10,
    target2026: 8.5,
    keyLearning: [
      'Strong management commitment and effective compliance programs enabled TTT Group to achieve SPIKE score of 9.25.',
      'Zero Lost Time Injury and Incident Rate demonstrated effective safety management and preventive risk control.',
    ],
    improvementPlan: [
      'Maintain zero Lost Time Injury and Incident Rate through proactive risk identification, preventive measures, and continuous safety awareness programs.',
      'Strengthen worker participation and social dialogue through Welfare Committee engagement, grievance system effectiveness, and structured capacity-building programs aligned with SI-KPI 2026 requirements.',
    ],
    extraSlides: [
      {
        title: 'Social Compliance — 2025 S-KPI Results by Factory',
        type: 'factory-results',
        factoryData: {
          headers: ['Factory', 'S-KPI Score', 'Level', 'SPIKE Points'],
          rows: [
            ['TTT', '95.4%', '5S', '10'],
            ['VAS', '88.9%', '4S', '9'],
            ['TITAN', '89.7%', '4S', '9'],
            ['TM', '89.6%', '4S', '9'],
          ],
          summary: 'TTT Group SPIKE Score = Average = 9.25',
        },
      },
      {
        title: 'Social Compliance — 2025 Key Success',
        type: 'key-success',
        items: [
          'Thong Thai achieved 5S and Improvement Certificate',
          'All other factories achieved 4S, showing strong group performance',
          'Maintained zero Lost Time Injury and Incident Rate',
        ],
        support: [
          'Alignment on expectations',
          'Continuous feedback during the year',
          'Timely communication on new initiatives',
        ],
      },
      // Target & January Results moved into Environmental data slide (combined slide 21+22)
    ],
  },
  {
    id: 'environmental',
    name: 'Environmental (EKPI)',
    category: 'ESG',
    catColor: '#2e7d32',
    lead: 'Anuchit',
    maxPts: 7,
    currentScore: 3.85,
    rollingPct: null,
    janPct: null,
    targetPct: '4.2 / 7 pts',
    description: 'Environmental performance covers 3 topics: Decarbonization (3 pts), Nature (3 pts), EA — Environmental Assessment (1 pt).',
    // Social Compliance target data (combined from former slide 21)
    socialTargetData: {
      targetHeaders: ['SI-KPI 2026 Target', 'TTT', 'VAS', 'TITAN', 'TM'],
      targetRows: [
        ['Target Score Scale', 'High Perf.', 'High Perf.', 'High Perf.', 'High Perf.'],
        ['Target SPIKE Points', '8–9', '8–9', '8–9', '8–9'],
      ],
      targetSummary: 'Group target: 8.5 SPIKE points',
      janHeaders: ['January 2026 Result', 'TTT', 'VAS', 'TITAN', 'TM'],
      janRows: [
        ['Score %', '~48%', '~48%', '~48%', '~48%'],
        ['Performance Level', 'Low Perf.', 'Low Perf.', 'Low Perf.', 'Low Perf.'],
        ['SPIKE Score', '0', '0', '0', '0'],
      ],
      janSummary: 'SI-KPI audited Q4 only — January is preliminary baseline',
    },
    // Factory breakdown table instead of simple scoring ranges
    scoring: [],
    scoringIsFactories: true,
    factoryData: {
      headers: ['EKPI Jan 2026', 'Full Score', 'TTT', 'VAS', 'Titan', 'TM2'],
      rows: [
        ['Decarbonization', '3', '2.4', '0', '2.4', 'N/A'],
        ['Nature', '3 (6 for TM)', '1.7', '2.3', '1.8', '0.8'],
        ['Env. Assessment', '1', '1', '1', '1', '1'],
        ['Total', '7', '5.1', '3.3', '5.2', '1.8'],
      ],
      summary: 'SPIKE Score = Average of all factories = 3.85',
    },
    currentRange: 'Avg = 3.85',
    hasLearning: true,
    endYear2025: 4,
    maxPts2025: 5,
    target2026: 4.2,
    keyLearning: [
      'The most challenging part of SBTi implementation is not data collection, but achieving real GHG reductions across Scope 1, 2, and 3 in line with our Near-Term Target (2024–2033).',
      'In 2025, TTT Group successfully reduced emissions in all three scopes through strong leadership commitment, cross-functional collaboration, integrated planning, and active awareness and participation from all employees.',
      'This demonstrates that decarbonization requires strategic execution and collective action — not reporting alone.',
    ],
    improvementPlan: [
      'Decarbonization — Renewable Energy: Install additional solar rooftop systems or purchase I-RECs. Analyze energy consumption and implement energy reduction measures within the factory.',
      'Nature — Waste Recycling Rate%: Implement a waste segregation campaign within the factory to separate recyclable waste.',
      'Nature — Water Availability Recycling Rate%: Reuse RO reject water for toilet flushing.',
    ],
    extraSlides: [
      {
        title: 'Environmental — 2025 Key Success',
        type: 'key-success',
        items: [
          'Thailand Factories achieved 5E rating',
          'The SBTi of TTT Group has achieved the Exceed level',
        ],
      },
    ],
  },
  {
    id: 'traceability',
    name: 'Product Traceability',
    category: 'ESG',
    catColor: '#2e7d32',
    lead: 'Pradthana',
    maxPts: 3,
    currentScore: 2,
    rollingPct: null,
    janPct: null,
    targetPct: '3 / 3 pts',
    description: 'Three KPI areas:\n1. Data Completeness: Full traceability info for all sustainable PO lines in SMTT SP\n2. Data Timeliness: Traceability and SCM info submitted on time in SMTT SP\n3. Data Accuracy: Facility transaction data input accuracy in SMTT SP',
    scoring: [],
    scoringIsComponents: true,
    // Three separate component scoring tables from PPTX slide 25
    componentScoring: [
      { label: 'Data Completeness', headers: ['Criteria', 'Points'], rows: [['Article mapping < 98% -or- PO line < 90%', '0'], ['Article mapping ≥ 98% -and- PO line ≥ 90%', '1']] },
      { label: 'Data Timeliness', headers: ['Criteria', 'Points'], rows: [['Mapping on-time < 91% -or- SCM Delay', '0'], ['Mapping on-time ≥ 91% -and- SCM On-time', '1']] },
      { label: 'Data Accuracy', headers: ['Criteria', 'Points'], rows: [['Audit pass < 80%', '0'], ['Audit pass ≥ 80%', '1']] },
    ],
    monthlyData: {
      headers: ['KPI', 'YTD', 'Nov 25', 'Dec 25', 'Jan 26', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'],
      rows: [
        ['SMTT PO Mapping%', '100%', '100%', '100%', '100%', '', '', '', '', '', '', '', '', ''],
        ['Completeness Score', '1', '1', '1', '1', '', '', '', '', '', '', '', '', ''],
        ['SMTT Ontime%', '100%', '100%', '100%', '100%', '', '', '', '', '', '', '', '', ''],
        ['Timeliness Score', '1', '1', '1', '1', '', '', '', '', '', '', '', '', ''],
        ['Audit Pass%', 'N/A', 'N/A', 'N/A', 'N/A', '', '', '', '', '', '', '', '', ''],
        ['Accuracy Score', 'N/A', 'N/A', 'N/A', 'N/A', '', '', '', '', '', '', '', '', ''],
      ],
    },
    currentRange: '2 / 3',
    hasLearning: true,
    endYear2025: 5,
    maxPts2025: 5,
    target2026: 3,
    keyLearning: [
      'Map all sustainable PO lines and verify traceability requirements. Collaborate with T2 suppliers to validate Scope Certifications.',
      'Integrate traceability data submission into the PO confirmation process.',
      'Ensure traceability and SCM information is submitted on time in SMTT.',
    ],
    improvementPlan: [
      'Monitor submission status weekly via SMTT and escalate any delays promptly.',
      'Ensure facility transaction data entered in SMTT is accurate.',
      'Conduct monthly data validation audits. Cross-check facility names, locations, and certification validity.',
    ],
  },
  // ===== QUALITY =====
  {
    id: 'quality',
    name: 'Quality (Q-KPI)',
    category: 'Quality',
    catColor: '#8e24aa',
    lead: 'Rapeepat',
    maxPts: 15,
    currentScore: 0,
    rollingPct: null,
    janPct: null,
    targetPct: '10 / 15 pts — Target: 4Q (≥ 80%)',
    hideScoring: true,
    showKeyLearningOnDataSlide: true,
    description: 'All active facilities measured and scored in Q-KPI or Q-KPI Light program. Performance measured by Quality team. AD4 SPIKE = average of COO-TH and COO-MM scores.',
    // Full 16-level scoring from PPTX (hidden via hideScoring flag — kept for reference)
    scoring: [
      ['< 60%', 0], ['≥ 60%', 1], ['≥ 64%', 2], ['≥ 67%', 3], ['≥ 70%', 4],
      ['≥ 73%', 5], ['≥ 76%', 6], ['≥ 78%', 7], ['≥ 80%', 8], ['≥ 82%', 9],
      ['≥ 84%', 10], ['≥ 86%', 11], ['≥ 88%', 12], ['≥ 90%', 13], ['≥ 91%', 14], ['≥ 92%', 15],
    ],
    currentRange: 'Not yet scored',
    // 2024 vs 2025 QKPI comparison by COO (from PPT image 24)
    factoryData: {
      headers: ['QKPI Pillars', '2024<br>COO-TH', '2025<br>COO-TH', '2024<br>COO-MM', '2025<br>COO-MM'],
      rows: [
        ['Digital–Pivot88 (10)', '3', '5', '3', '5'],
        ['Defective Returns (10)', '10', '4', '0', '7'],
        ['Warehouse Claims (30)', '23', '7', '5', '25'],
        ['AQL Validation (10)', '9', '9', '5', '7'],
        ['QA Manufacturing (10)', '6.7', '8', '5', '6'],
        ['Testing: Lab & OCPT (10)', '9', '10', '10', '10'],
        ['Yearly Focus Topic (10)', '7', '8', '7', '8'],
        ['Culture (10)', '9', '8', '5', '8'],
        ['Total QKPI Scores', '76', '59', '40', '76'],
        ['Q-KPI Rating Result', '3Q', '2Q', '2Q', '3Q'],
      ],
      summary: 'AD4 SPIKE score = (0 + 6) / 2 = 3.0 — End Year 2025',
    },
    hasLearning: false,  // learning content moved: Key Learning → data slide, Improvement Plan → combined plan slide
    endYear2025: 3.0,
    maxPts2025: 15,
    target2026: 10,
    keyLearning: [
      'Overall QKPI for AD4014 (COO-MM) increased from 40 in 2024 to 76 in 2025, especially WHC and DR performance pillars.',
      'Got max 10 scores in QKPI-Testing for both COO-Thailand and Myanmar.',
      'Digital-Pivot QKPI scores increased from 2024 to 2025 for both COOs.',
      'CE (Defective Return/WH Claim) QKPI for COO Thailand decreased — WHC decreased 16 scores, mainly from VAS during Q1-Q2 2025 caused by CMA Functional testing failure for aChina POs. After improvement, Q3-Q4 2025 no more CMA-WHC.',
      'WH Claim total reduced: 65,650 pcs / $301K (2024) → 18,798 pcs / $32.7K (2025), a 71% reduction.',
    ],
    improvementPlan: [
      'Target all factories at 4Q level (≥ 80%). 2026 plan: TTT=82, VAS=82, TITAN=82, TTM=86. AD4 SPIKE = (9+11)/2 = 10.',
      'QMS: Standardize ISO 9001:2015 across all factories. Establish digital QMS through CTQ & QAR Portal.',
      'People: Digital AI quality soft-skill training for middle management. Reinforcement of RQC "Right Quality Culture" especially for Football BU.',
      'Process: CTQ Risk assessment E2E system. Internal X-CTQ and quality process audits. Enhancement of Quality statistical control charts.',
      'Compliance: CTQ & OCPT integration. Lab testing capacity expansion. Culture & QA manufacturing audit enhancement.',
    ],
    extraSlides: [
      {
        title: 'End Year 2025 QKPI Score — Updated from adidas Global',
        type: 'visual-combined',
        images: [
          { src: 'qkpi-all.png', label: 'AD4 — GROUP LEVEL', width: '60%' },
          { src: 'qkpi-ttt.png', label: 'AD4001 — COO TH', width: '48%' },
          { src: 'qkpi-ttm.png', label: 'AD4014 — COO MM', width: '48%' },
        ],
        scaleImage: 'qkpi-scale.png',
      },
      // 2024 vs 2025 Comparison removed — data now in factoryData on data slide
      {
        title: 'CE QKPI — 2025 WH Claim Analysis',
        type: 'visual',
        image: 'whclaim-analysis.png',
        caption: 'Total Claim 18,798 pcs. China claimed 15,306 pcs (81%). AD4001 CMA failure 11,491 pcs (75%), AD4014 Labeling & Workmanship 3,731 pcs (24.5%).',
      },
      {
        title: 'WH Claim — 2024 VS 2025 Performance Comparison',
        type: 'visual',
        image: 'whclaim-comparison.png',
        caption: 'Grand Total: 65,650 pcs / $301K (2024) → 18,798 pcs / $32.7K (2025) — 71% reduction. TTM improved significantly from 62,089 to 3,869 pcs.',
      },
      {
        title: 'Quality — 2026 Plan & Strategy',
        type: 'plan-strategy-combined',
        factoryData: {
          headers: ['2026 QKPI', 'AD4001+4013<br>TTT', 'AD4002<br>VAS', 'AD4008<br>TITAN', 'AD4014<br>TTM'],
          rows: [
            ['Excellence (75)', '58', '58', '58', '62'],
            ['- Consumer Returns (15)', '10', '10', '10', '12'],
            ['- WH Claim (30)', '24', '24', '24', '26'],
            ['- Non-Conformity QAR (30)', '24', '24', '24', '24'],
            ['Enablers (25)', '24', '24', '24', '24'],
            ['- Critical To Quality (10)', '9', '9', '9', '9'],
            ['- Testing Lab. Accreditation (10)', '10', '10', '10', '10'],
            ['- OCPT Audit (5)', '5', '5', '5', '5'],
            ['Total QKPI score (Q Ranking)', '82', '82', '82', '86'],
            ['SPIKE point', '9', '9', '9', '11'],
          ],
          summary: 'AD4 SPIKE point plan = (9 + 11) / 2 = 10',
        },
        pillars: [
          { name: 'QMS (Enhancement)', color: 'var(--accent)', items: [
            'Standardize and align ISO 9001:2015 QMS across all factory facilities (Q1-Q3)',
            'Establish Key Football Quality message/slogan to build quality mindset (Q1)',
            'Establishing digital QMS through CTQ & QAR Portal/App and dashboard (Q1-Q2)',
          ]},
          { name: 'People (Upskilling)', color: 'var(--green)', items: [
            'Digital AI quality soft-skill & knowledge improvement for middle management (Q1-Q2)',
            'Corrective & Preventive Actions advance training by 3rd party (Q1-Q2)',
            'Reinforcement RQC "Right Quality Culture" especially Football BU (Q1)',
          ]},
          { name: 'Process (Reinforcement)', color: 'var(--yellow)', items: [
            'CTQ Risk assessment internal E2E system enhancement (Q1-Q3)',
            'Internal X-CTQ and quality process audits across all facilities (Q1-Q4)',
            'Reinforce E2E Quality inspection SOP & internal certification for QCs/QAs (Q1-Q2)',
          ]},
          { name: 'Compliance (Conformity)', color: '#8e24aa', items: [
            'Integrate CTQ & OCPT facilities and resources from Dev. to production (Q2-Q3)',
            'Enhance Lab testing capacity & capabilities across TTT Group (Q1-Q2)',
            'Culture & QA manufacturing audit enhancement: non-conformity at source (Q1-Q4)',
          ]},
        ],
      },
    ],
  },
  // ===== COMPETENCY =====
  {
    id: 'product-dev',
    name: 'Product & Dev Competency',
    category: 'Competency',
    catColor: '#e65100',
    lead: 'Kanyakorn',
    maxPts: 20,
    currentScore: 10,
    rollingPct: null,
    janPct: null,
    targetPct: '13 / 20 pts',
    description: 'Measures the overall Product & Development competency level of the supplier group\'s Development Capability. 7 sub-KPIs assessed monthly.',
    scoring: [
      ['Below expectation', '0–6'], ['Meet expectation', '7–13'],
      ['Exceed expectation', '14–17'], ['Outstanding', '18–20'],
    ],
    currentRange: 'Meet expectation',
    // 7 sub-KPI tracking table from PPTX slide 36
    subKpis: [
      { name: 'Category Knowledge and Expertise', target: 'Exceed expectation', jan: 'Meet expectation' },
      { name: 'Product Expertise', target: 'Exceed expectation', jan: 'Meet expectation' },
      { name: 'Development Sample Performance', target: 'Exceed expectation', jan: 'Meet expectation' },
      { name: 'Buy Ready Excellence', target: 'Exceed expectation', jan: 'Meet expectation' },
      { name: 'Adaptability and Iteration Capability', target: 'Exceed expectation', jan: 'Meet expectation' },
      { name: 'Adherence to adidas Policy and Calendar', target: 'Exceed expectation', jan: 'Meet expectation' },
      { name: 'Product Mix', target: 'Exceed expectation', jan: 'Meet expectation' },
    ],
    hasLearning: true,
    endYear2025: 9,
    maxPts2025: 15,
    target2026: 13,
    keyLearning: [
      'Cross-Category Alignment (CC Onsite Trip) — Gained deep alignment on development expectations and quality standards across Football, Golf, Tennis, and GTS teams.',
      'Football License Readiness — Successfully assessed and launched Base styles 26, 27 and 28 as a new license entrant.',
      'Complex Product Capability — Demonstrated strong expertise in complex bonding constructions including Stella and FB Goalkeeper products.',
      'Buy Ready Excellence — Achieved 99% Buy Ready On-Time in 2025.',
      'Operational Performance — 98% Proto development sample on-time delivery, 99% Commercial sample on-time delivery.',
    ],
    improvementPlan: [
      'Strategic Development Capacity Planning — Proactively align with CC range projections for early resource planning.',
      'FB License Base29 Engagement — Proactively engage in creation and coordination with FB LIC for Base 29.',
      'Organizational Agility — Expand and upskill team to support emerging categories (Outdoor, Kids Bra, etc.).',
      'Digital Enablement — Deploy digital tracking and workflow tools for sustainable Buy Ready on-time performance.',
      'adidas Standards Implementation — Fully implement standard workflows for CTQ, FB LIC co-creation, and Fit4Purpose Tech Pack.',
    ],
    extraSlides: [],
  },
  {
    id: 'engineering',
    name: 'Engineering Solutions',
    category: 'Competency',
    catColor: '#e65100',
    lead: 'Araya',
    maxPts: 10,
    currentScore: null,
    rollingPct: null,
    janPct: null,
    targetPct: '6 / 10 pts',
    description: 'Measures the overall product & development competency level of the supplier group\'s Development Capability. Replaces ME from Competitive in 2026.',
    scoring: [
      ['Fundamentals', 4], ['Concepts', 6],
    ],
    currentRange: 'Not yet scored',
    scoringIsComponents: true,
    hasLearning: false,
    extraSlides: [
      {
        title: 'Engineering Solutions — KPI Framework',
        type: 'framework-table',
        tableData: {
          headers: ['Level', 'Points', 'Sub-Area', 'Description'],
          rows: [
            ['Fundamentals', '4 pts', 'Lean', 'Demonstrates maturity in implementation of lean principles'],
            ['', '', 'Automation', 'Deskilling applications/equipment to drive product excellence at development center and factory level'],
            ['', '', 'Digital', 'Data Driven Production Management & E2E Planning through Production Data Capture and Availability'],
            ['', '', 'Commitment', 'Ensure adequate team setup to drive valued initiatives'],
            ['Concepts (HPC)', '6 pts<br><span style="font-size:9px;color:#888">(shared)</span>', 'HPC Delivery', 'Deliver brand innovation concepts for athletes/events'],
            ['', '', 'HPC Ingredients', 'Provide and Deliver Innovation Solutions integrated in the HPC'],
            ['', '', 'Commitment', 'Dedicated expertise allocated to HPC with innovative mindset'],
            ['Capabilities', '<span style="color:#888">Future</span>', 'Ingredients', 'Textile Innovation, Foam, Polymer, Process & Method of Make'],
            ['', '', 'Digital Asset', 'Assisted product engineering for factory in scope'],
            ['', '', 'Commercial Tech', 'Adopt and land mature technology across products'],
            ['Excellence', '<span style="color:#888">Future</span>', 'Method of Make', 'Best-in-class practices elevating Product Execution Consistency & Deskilling'],
            ['', '', 'Benchmarking', 'Feature Complexity, Output Performance, Commercial Readiness for Critical Processes'],
            ['', '', 'Solution Ownership', 'Deploy resources to new facilities & proactively scout/validate manufacturing technologies'],
          ],
          levelDescriptions: [
            { level: 'Fundamentals', focus: 'Continuous Improvement / Self Governance', scored: true },
            { level: 'Concepts', focus: 'High Performance Concepts (HPC)', scored: true },
            { level: 'Capabilities', focus: 'Innovation & Commercial-ready', scored: false },
            { level: 'Excellence', focus: 'Product Centric', scored: false },
          ],
        },
      },
    ],
  },
];

// Slide 5 data: grouped by category so left and right rows always align
const fwGroups = [
  {
    catLeft: 'Agile — 25%', catRight: 'Agile — 20% (was 25%)', catCls: 'fw-cat-agile',
    left: [
      { name: 'Availability',   pts: 10, cls: '',                desc: 'MDP (7) + SDP (3)' },
      { name: 'Responsiveness', pts: 15, cls: 'highlight-changed', desc: 'Resp (5) + Origin Opt (5) + Elevated Focus Delivery (5)' },
    ],
    right: [
      { name: 'Availability',   pts: 10, cls: '',                desc: 'Same — MDP (7) + SDP (3)' },
      { name: 'Responsiveness', pts: 10, cls: 'highlight-changed', desc: '15→10; Origin Opt moved to Cost; now Resp(5)+Elevated Focus Delivery(5)' },
    ]
  },
  {
    catLeft: 'Competitive — 25%', catRight: 'Competitive — 15% (was 25%)', catCls: 'fw-cat-competitive',
    left: [
      { name: 'FOB', pts: 10, cls: 'highlight-changed', desc: 'Actual vs Target FOB variance (0-10 scale)' },
      { name: 'ME',  pts: 15, cls: 'highlight-removed',  desc: 'Efficiency roadmap (5) + Enablers projects (10)' },
    ],
    right: [
      { name: 'FOB / Landed Cost Achievement', pts: 15, cls: 'highlight-changed', desc: '10→15; FOB Target(5) + Holistic Cost(5) + Duty Benefit(5)' },
      null,  // empty — ME moved to Competency
    ]
  },
  {
    catLeft: 'ESG — 20%', catRight: 'ESG — 20% (unchanged)', catCls: 'fw-cat-esg',
    left: [
      { name: 'Social Compliance',  pts: 10, cls: '', desc: 'S-KPI or Compliance Scorecard' },
      { name: 'Env + Traceability', pts: 10, cls: 'highlight-changed', desc: 'Environmental (5) + Traceability (5)' },
    ],
    right: [
      { name: 'Social Compliance',      pts: 10, cls: '', desc: 'Same — S-KPI or Compliance Scorecard' },
      { name: 'Sourcing Sustainability', pts: 10, cls: 'highlight-changed', desc: 'Was Env(5)+Trace(5) → now Env(7)+Trace(3)' },
    ]
  },
  {
    catLeft: 'Quality — 15%', catRight: 'Quality — 15% (unchanged)', catCls: 'fw-cat-quality',
    left: [
      { name: 'Quality', pts: 15, cls: '', desc: 'Q-KPI Full or Q-KPI Light program' },
    ],
    right: [
      { name: 'Quality', pts: 15, cls: '', desc: 'Same — Q-KPI Full or Light program' },
    ]
  },
  {
    catLeft: 'Competency — 15%', catRight: 'Competency — 30% (was 15%)', catCls: 'fw-cat-competency',
    left: [
      { name: 'Product & Dev Comp', pts: 15, cls: 'highlight-changed', desc: 'Competency (6) + Discipline (2) + Enablement (2) + NPS (5)' },
      null,  // empty — no equivalent for Engineering Solutions in 2025
    ],
    right: [
      { name: 'Product & Dev Competency', pts: 20, cls: 'highlight-changed', desc: '15→20; +5 pts from new POPS NPS score' },
      { name: 'Engineering Solutions',    pts: 10, cls: 'highlight-new',     desc: 'NEW — replaces ME (moved from Competitive)' },
    ]
  },
];

// Key callouts for slide 3
const callouts = [
  { label: 'Availability',  val: '0 → 4',   cls: 'up' },
  { label: 'ME',             val: '7 → 12',  cls: 'up' },
  { label: 'Responsiveness', val: '5 → 9',   cls: 'up' },
  { label: 'Traceability',   val: '3 → 5',   cls: 'up' },
  { label: 'Quality',        val: '5 → 3',   cls: 'down' },
  { label: 'FOB',            val: '6 → 5',   cls: 'down' },
];

// =============================================
// HELPERS
// =============================================

// Return a color class based on how much of the max was scored
function barColor(score, max) {
  const pct = score / max;
  if (pct <= 0)   return 'bar-red';
  if (pct < 0.4)  return 'bar-red';
  if (pct < 0.65) return 'bar-yellow';
  return 'bar-green';
}

// Build a bar row HTML string
function buildBarRow(label, max, score, extraClass) {
  const pct = (score / max) * 100;         // percentage width for the bar
  const color = barColor(score, max);       // pick red/yellow/green
  return `
    <div class="bar-row ${extraClass || ''}">
      <div class="bar-label">${label}</div>
      <div class="bar-track">
        <div class="bar-fill ${color}" data-width="${pct}">
          <span class="bar-value">${score} / ${max}</span>
        </div>
      </div>
    </div>`;
}

// Build a bar row for 2026 (with target dashed line and progress %)
function buildBarRow2026(label, max, target, jan, note) {
  const janPct = (jan / max) * 100;         // bar width based on January score
  const targetPct = (target / max) * 100;   // dashed target line position
  const progressPct = target > 0 ? Math.round((jan / target) * 100) : 100;
  const color = barColor(jan, max);
  const noteHtml = note ? `<span class="note-badge">${note}</span>` : '';
  return `
    <div class="bar-row">
      <div class="bar-label">${label}${noteHtml}</div>
      <div class="bar-track">
        <div class="bar-fill ${color}" data-width="${janPct}">
          <span class="bar-value">${jan} / ${max}</span>
        </div>
        <div class="bar-target-line" style="left:${targetPct}%">
          <span class="bar-target-label">target ${target}</span>
        </div>
        <span class="bar-pct">${progressPct}% of target</span>
      </div>
    </div>`;
}

// =============================================
// KPI SLIDE BUILDERS
// =============================================

// Build an SVG mini line chart showing monthly data with a target line
// data = array of monthly values (Jan=index 0), targetVal = dashed target line, color = line color
// projData = optional array of 12 projected values (null for actual-data months)
function buildSvgChart(data, targetVal, maxY, color, projData) {
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const w = 500;                            // SVG viewBox width
  const h = 180;                            // SVG viewBox height
  const pad = 40;                           // padding for axes
  const chartW = w - pad * 2;               // usable chart width
  const chartH = h - pad * 2;               // usable chart height

  // Scale a value (0–maxY) to a Y pixel coordinate (top = high values)
  function yPos(val) { return pad + chartH - (val / maxY) * chartH; }
  // Scale a month index (0–11) to an X pixel coordinate
  function xPos(i) { return pad + (i / 11) * chartW; }

  let svg = `<svg viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">`;

  // Background grid lines (horizontal at 25%, 50%, 75%, 100%)
  for (let p = 0; p <= 100; p += 25) {
    const y = yPos(maxY * p / 100);
    svg += `<line x1="${pad}" y1="${y}" x2="${w - pad}" y2="${y}" stroke="#ddd" stroke-width="0.5"/>`;
    svg += `<text x="${pad - 6}" y="${y + 4}" fill="#888" font-size="9" text-anchor="end">${Math.round(maxY * p / 100)}%</text>`;
  }

  // Month labels along bottom
  months.forEach((m, i) => {
    svg += `<text x="${xPos(i)}" y="${h - 8}" fill="#888" font-size="8" text-anchor="middle">${m}</text>`;
  });

  // Target dashed line
  if (targetVal != null) {
    const ty = yPos(targetVal);
    svg += `<line x1="${pad}" y1="${ty}" x2="${w - pad}" y2="${ty}" stroke="${color}" stroke-width="1" stroke-dasharray="6,4" opacity="0.5"/>`;
    svg += `<text x="${w - pad + 4}" y="${ty + 3}" fill="${color}" font-size="9" opacity="0.7">Target</text>`;
  }

  // Data line and dots
  if (data.length > 0) {
    // Draw connecting line if multiple points
    if (data.length > 1) {
      const points = data.map((val, i) => `${xPos(i)},${yPos(val)}`).join(' ');
      svg += `<polyline points="${points}" fill="none" stroke="${color}" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>`;
    }
    // Draw dots and value labels for each data point
    data.forEach((val, i) => {
      const cx = xPos(i);
      const cy = yPos(val);
      svg += `<circle cx="${cx}" cy="${cy}" r="5" fill="${color}" stroke="#fff" stroke-width="2"/>`;
      svg += `<text x="${cx}" y="${cy - 10}" fill="#1a1a1a" font-size="10" font-weight="bold" text-anchor="middle">${val}%</text>`;
    });
  }

  // Projection line and dots (dashed, lighter color)
  if (projData && projData.length > data.length) {
    // Build projection points starting from last actual data point
    let projPoints = [];
    if (data.length > 0) {
      projPoints.push(`${xPos(data.length - 1)},${yPos(data[data.length - 1])}`);
    }
    for (let i = data.length; i < projData.length; i++) {
      if (projData[i] != null) {
        projPoints.push(`${xPos(i)},${yPos(projData[i])}`);
      }
    }
    // Draw dashed line connecting projection points
    if (projPoints.length > 1) {
      svg += `<polyline points="${projPoints.join(' ')}" fill="none" stroke="${color}" stroke-width="2" stroke-dasharray="6,4" stroke-linecap="round" stroke-linejoin="round" opacity="0.45"/>`;
    }
    // Draw hollow circles and labels for projected months
    for (let i = data.length; i < projData.length; i++) {
      if (projData[i] != null) {
        const cx = xPos(i);
        const cy = yPos(projData[i]);
        svg += `<circle cx="${cx}" cy="${cy}" r="4" fill="none" stroke="${color}" stroke-width="2" opacity="0.45"/>`;
        svg += `<text x="${cx}" y="${cy - 10}" fill="${color}" font-size="9" text-anchor="middle" opacity="0.5">${projData[i]}%</text>`;
      }
    }
    // Legend
    svg += `<line x1="${pad}" y1="${h - 2}" x2="${pad + 25}" y2="${h - 2}" stroke="${color}" stroke-width="2.5"/>`;
    svg += `<text x="${pad + 29}" y="${h}" fill="#777" font-size="7">Actual</text>`;
    svg += `<line x1="${pad + 70}" y1="${h - 2}" x2="${pad + 95}" y2="${h - 2}" stroke="${color}" stroke-width="2" stroke-dasharray="4,3" opacity="0.45"/>`;
    svg += `<text x="${pad + 99}" y="${h}" fill="#777" font-size="7">Estimated</text>`;
  }

  // "No data yet" placeholders for months with no actual or projected data
  for (let i = data.length; i < 12; i++) {
    if (!projData || projData[i] == null) {
      svg += `<circle cx="${xPos(i)}" cy="${yPos(0)}" r="3" fill="#ddd" opacity="0.5"/>`;
    }
  }

  svg += '</svg>';
  return svg;
}

// Build HTML for a KPI category header slide
function buildCategoryHeaderSlide(cat) {
  const kpiList = cat.kpis.map(k => `<li>${k}</li>`).join('');
  return `
    <div class="slide" data-animate="kpi-category">
      <div class="kpi-cat-header">
        <div class="kpi-cat-name" style="color:${cat.color}">${cat.name}</div>
        <div class="kpi-cat-pts">${cat.pts} points · ${cat.kpis.length} KPI${cat.kpis.length > 1 ? 's' : ''}</div>
        <ul class="kpi-cat-list">${kpiList}</ul>
      </div>
    </div>`;
}

// Build HTML for a KPI data slide (chart + scoring table + score display)
// Helper: build a generic data table from headers + rows arrays
function buildDataTable(headers, rows, highlightRowLabel, rollRow) {
  let html = '<div class="kpi-data-table-wrap"><table class="kpi-data-table"><thead><tr>';
  headers.forEach(h => { html += `<th>${h}</th>`; });
  html += '</tr></thead><tbody>';
  rows.forEach(row => {
    html += '<tr>';
    row.forEach(cell => { html += `<td>${cell}</td>`; });
    html += '</tr>';
  });
  // Optional highlighted rolling/total row at the bottom
  if (rollRow) {
    html += '<tr class="highlight-row">';
    rollRow.forEach(cell => { html += `<td>${cell}</td>`; });
    html += '</tr>';
  }
  html += '</tbody></table></div>';
  return html;
}

function buildKpiDataSlide(kpi) {
  // Category badge with colored background
  const badge = `<span class="kpi-cat-badge" style="background:${kpi.catColor}22;color:${kpi.catColor};border:1px solid ${kpi.catColor}44">${kpi.category}</span>`;

  // Score display — show current score or "X" if not yet scored
  const scoreText = kpi.currentScore != null ? kpi.currentScore : 'X';
  const scoreColor = kpi.currentScore != null ? kpi.catColor : 'var(--text-dim)';

  // Rolling percentage badges (only for KPIs that have percentage data)
  let pctBadges = '';
  if (kpi.rollingPct != null || kpi.janPct != null) {
    pctBadges = '<div class="kpi-pct-row">';
    if (kpi.rollingPct != null) {
      pctBadges += `<div class="kpi-pct-badge"><span class="val" style="color:${kpi.catColor}">${kpi.rollingPct}%</span>Rolling</div>`;
    }
    if (kpi.janPct != null) {
      pctBadges += `<div class="kpi-pct-badge"><span class="val" style="color:${kpi.catColor}">${kpi.janPct}%</span>January</div>`;
    }
    pctBadges += '</div>';
  }

  // SVG chart (only for KPIs with percentage-based rolling data)
  let chartHtml = '';
  if (kpi.rollingPct != null) {
    const chartData = [kpi.janPct || kpi.rollingPct];
    const targetNum = parseFloat(kpi.targetPct) || 90;

    // Extract projection data from monthlyData rows (look for "Proj" or use rollRow)
    let projData = null;
    if (kpi.monthlyData) {
      const projRow = kpi.monthlyData.rows.find(r => r[0].includes('Proj'));
      const sourceRow = projRow || (kpi.monthlyData.rollRow ? kpi.monthlyData.rollRow : null);
      if (sourceRow) {
        projData = sourceRow.slice(1, 13).map(v => {
          const num = parseFloat(v);
          return isNaN(num) ? null : num;
        });
      }
    }

    chartHtml = `<div class="kpi-chart-card">${buildSvgChart(chartData, targetNum, 100, kpi.catColor, projData)}</div>`;
  }

  // Trend image (if present — e.g. Quality Q-KPI end year 2025)
  let trendImageHtml = '';
  if (kpi.trendImage) {
    trendImageHtml = `<div style="margin:4px 0;text-align:center"><img src="${kpi.trendImage}" alt="End Year 2025 Trend" style="max-width:100%;max-height:240px;border-radius:6px;border:1px solid #e0e0e0"></div>`;
  }

  // Key Learning inline on data slide (Quality — replaces trend image)
  let keyLearningHtml = '';
  if (kpi.showKeyLearningOnDataSlide && kpi.keyLearning) {
    const learningItems = kpi.keyLearning.map(item => `<li style="margin-bottom:6px">${item}</li>`).join('');
    keyLearningHtml = `
      <div style="background:var(--bg-card);border:1px solid #e0e0e0;border-radius:10px;padding:16px 20px;margin:8px 0">
        <h4 style="font-size:16px;font-weight:700;color:var(--yellow);margin-bottom:8px">Key Learning 2025</h4>
        <ul style="font-size:14px;padding-left:20px;margin:0">${learningItems}</ul>
      </div>`;
  }

  // Monthly data table (if present — MDP, SDP, Responsiveness, EFD, Traceability)
  let monthlyHtml = '';
  if (kpi.monthlyData) {
    monthlyHtml = buildDataTable(kpi.monthlyData.headers, kpi.monthlyData.rows, kpi.monthlyData.highlightRow, kpi.monthlyData.rollRow);
  }

  // Factory data table (if present — Environmental, Quality)
  let factoryHtml = '';
  if (kpi.factoryData) {
    factoryHtml = buildDataTable(kpi.factoryData.headers, kpi.factoryData.rows);
    if (kpi.factoryData.summary) {
      factoryHtml += `<div style="text-align:center;font-size:13px;color:var(--accent);margin-top:6px;font-weight:600">${kpi.factoryData.summary}</div>`;
    }
  }

  // Social Compliance target data (combined slide for Environmental)
  let socialTargetHtml = '';
  if (kpi.socialTargetData) {
    const st = kpi.socialTargetData;
    socialTargetHtml += `<div style="margin-top:8px;border-top:2px solid #2e7d32;padding-top:8px">`;
    socialTargetHtml += `<div style="font-size:12px;font-weight:700;color:#2e7d32;margin-bottom:4px">Social Compliance — 2026 Target & January Results</div>`;
    socialTargetHtml += buildDataTable(st.targetHeaders, st.targetRows);
    if (st.targetSummary) socialTargetHtml += `<div style="text-align:center;font-size:11px;color:var(--accent);margin-top:3px;font-weight:600">${st.targetSummary}</div>`;
    socialTargetHtml += buildDataTable(st.janHeaders, st.janRows);
    if (st.janSummary) socialTargetHtml += `<div style="text-align:center;font-size:10px;color:#888;margin-top:3px">${st.janSummary}</div>`;
    socialTargetHtml += `</div>`;
  }

  // Sub-KPI tracking table (Product & Dev Competency)
  let subKpiHtml = '';
  if (kpi.subKpis) {
    subKpiHtml = '<div class="kpi-data-table-wrap"><table class="kpi-data-table"><thead><tr><th>Sub-KPI</th><th>Target</th><th>Jan 2026</th></tr></thead><tbody>';
    kpi.subKpis.forEach(sk => {
      subKpiHtml += `<tr><td>${sk.name}</td><td>${sk.target}</td><td>${sk.jan}</td></tr>`;
    });
    subKpiHtml += '</tbody></table></div>';
    // Embed SPIKE Point Scale image below the sub-KPI table
    subKpiHtml += `
      <div style="margin-top:12px;text-align:center">
        <div style="font-size:12px;font-weight:600;color:#555;margin-bottom:6px">SPIKE Point Scale (0–20)</div>
        <img src="spike-scale.png" alt="SPIKE Point Scale" style="max-width:100%;max-height:80px;border-radius:6px;border:1px solid #e0e0e0">
        <div style="font-size:10px;color:#888;margin-top:4px">Poor (0) → Below Expectation (5) → Met Expectation (10) → Exceed Expectation (15) → Excellent (20)</div>
      </div>`;
  }

  // Scoring criteria table(s)
  let tableHtml = '';
  let explanationHtml = '';  // full-width explanation (placed below kpi-body)

  // Component-based scoring with separate tables (Traceability)
  if (kpi.componentScoring) {
    kpi.componentScoring.forEach(comp => {
      tableHtml += `<div class="kpi-scoring-label">${comp.label}</div>`;
      tableHtml += '<table class="kpi-scoring-table"><thead><tr>';
      comp.headers.forEach(h => { tableHtml += `<th>${h}</th>`; });
      tableHtml += '</tr></thead><tbody>';
      comp.rows.forEach(row => {
        tableHtml += '<tr>';
        row.forEach((cell, i) => { tableHtml += `<td${i === row.length - 1 ? ' class="pts-col"' : ''}>${cell}</td>`; });
        tableHtml += '</tr>';
      });
      tableHtml += '</tbody></table>';
      // Explanation card — extracted to full-width section below columns
      if (comp.explanation) {
        explanationHtml += `<div style="background:rgba(26,115,232,0.06);border:1px solid rgba(26,115,232,0.2);border-radius:6px;padding:10px 16px;margin-top:8px;">`;
        explanationHtml += `<div style="font-size:12px;font-weight:700;color:var(--accent);margin-bottom:4px">${comp.explanation.title}</div>`;
        explanationHtml += `<div style="font-size:11px;color:#555;line-height:1.5;margin-bottom:6px">${comp.explanation.text}</div>`;
        if (comp.explanation.example) {
          explanationHtml += `<div style="font-size:11px;font-weight:600;color:#333;margin-bottom:3px">${comp.explanation.example.title}:</div>`;
          explanationHtml += `<ul style="font-size:11px;color:#555;line-height:1.5;padding-left:18px;margin:0">`;
          comp.explanation.example.steps.forEach(step => {
            explanationHtml += `<li style="margin-bottom:3px">${step}</li>`;
          });
          explanationHtml += `</ul>`;
        }
        explanationHtml += `</div>`;
      }
    });
  }
  // Standard scoring table (if scoring array has entries and not hidden)
  else if (kpi.scoring && kpi.scoring.length > 0 && !kpi.hideScoring) {
    if (kpi.scoringLabel) tableHtml += `<div class="kpi-scoring-label">${kpi.scoringLabel}</div>`;
    tableHtml += '<table class="kpi-scoring-table"><thead><tr>';
    if (kpi.scoringIsFactories) {
      tableHtml += '<th>Factory</th><th class="pts-col">Score</th>';
    } else if (kpi.scoringIsComponents) {
      tableHtml += '<th>Component</th><th class="pts-col">Score</th>';
    } else {
      tableHtml += '<th>Range</th><th class="pts-col">Points</th>';
    }
    tableHtml += '</tr></thead><tbody>';
    kpi.scoring.forEach(([range, pts]) => {
      const isActive = (range === kpi.currentRange);
      tableHtml += `<tr${isActive ? ' class="active-range"' : ''}><td>${range}</td><td class="pts-col">${pts}</td></tr>`;
    });
    tableHtml += '</tbody></table>';
  }

  // Second scoring table for EFD (Sample MDP)
  if (kpi.scoringSample) {
    tableHtml += `<div class="kpi-scoring-label">${kpi.scoringSampleLabel || 'Sample Scoring'}</div>`;
    tableHtml += '<table class="kpi-scoring-table"><thead><tr><th>Range</th><th class="pts-col">Points</th></tr></thead><tbody>';
    kpi.scoringSample.forEach(([range, pts]) => {
      tableHtml += `<tr><td>${range}</td><td class="pts-col">${pts}</td></tr>`;
    });
    tableHtml += '</tbody></table>';
  }

  // CSC scoring table for Social Compliance (Route 2)
  let cscTableHtml = '';
  if (kpi.scoringCSC) {
    cscTableHtml += `<div class="kpi-scoring-label">${kpi.scoringCSCLabel || 'CSC Scoring'}</div>`;
    cscTableHtml += '<table class="kpi-scoring-table"><thead><tr><th>Range</th><th class="pts-col">Points</th></tr></thead><tbody>';
    kpi.scoringCSC.forEach(([range, pts]) => {
      cscTableHtml += `<tr><td>${range}</td><td class="pts-col">${pts}</td></tr>`;
    });
    cscTableHtml += '</tbody></table>';
  }

  // Score scale reference (SI-KPI performance levels)
  let scaleTableHtml = '';
  if (kpi.scoreScale) {
    scaleTableHtml += '<div class="kpi-scoring-label">SI-KPI ScoreScale</div>';
    scaleTableHtml += '<table class="kpi-scoring-table"><thead><tr><th>Range</th><th class="pts-col">Level</th></tr></thead><tbody>';
    kpi.scoreScale.forEach(([range, level]) => {
      scaleTableHtml += `<tr><td>${range}</td><td class="pts-col">${level}</td></tr>`;
    });
    scaleTableHtml += '</tbody></table>';
  }
  // If no separate CSC/scale, append to main tableHtml
  if (!kpi.scoringCSC && !kpi.scoreScale) {
    // nothing extra
  } else if (!kpi.scoringCSC) {
    tableHtml += scaleTableHtml;
  } else {
    // Keep them separate for multi-column layout
  }

  // Description — handle newlines as <br> tags
  const descHtml = kpi.description.replace(/\n/g, '<br>');

  // Evaluating note — shown for KPIs still being evaluated (e.g. Competitive)
  let evalNoteHtml = '';
  if (kpi.evaluatingNote) {
    evalNoteHtml = `<div class="kpi-evaluating-note">${kpi.evaluatingNote}</div>`;
  }

  // For component-scored KPIs with no chart (e.g. Competitive), use 3-column layout
  const hasNoChart = !chartHtml && !monthlyHtml && !factoryHtml && !subKpiHtml;
  const isMultiComponent = kpi.componentScoring && kpi.componentScoring.length >= 3;

  if (hasNoChart && isMultiComponent) {
    // Three-column layout: spread scoring tables across columns
    let cols = ['', '', ''];
    kpi.componentScoring.forEach((comp, idx) => {
      let colHtml = `<div class="kpi-scoring-label">${comp.label}</div>`;
      colHtml += '<table class="kpi-scoring-table"><thead><tr>';
      comp.headers.forEach(h => { colHtml += `<th>${h}</th>`; });
      colHtml += '</tr></thead><tbody>';
      comp.rows.forEach(row => {
        colHtml += '<tr>';
        row.forEach((cell, i) => { colHtml += `<td${i === row.length - 1 ? ' class="pts-col"' : ''}>${cell}</td>`; });
        colHtml += '</tr>';
      });
      colHtml += '</tbody></table>';
      cols[idx % 3] += colHtml;
    });

    return `
    <div class="slide" id="kpi-${kpi.id}-data" data-animate="kpi-data">
      <div class="kpi-data-slide">
        <div class="kpi-top-bar">
          ${badge}
          <span class="kpi-title">${kpi.name}</span>
          <span class="kpi-lead">Lead: ${kpi.lead}</span>
        </div>
        <div style="display:flex;gap:16px;align-items:flex-start">
          <div class="kpi-desc" style="flex:0 0 auto;max-width:220px">
            <div class="kpi-score-display" style="margin-bottom:10px;opacity:1">
              <div class="kpi-score-big" style="color:${scoreColor}">${scoreText}<span class="kpi-score-max"> / ${kpi.maxPts}</span></div>
              <div class="kpi-score-label">January 2026 Score</div>
            </div>
            <strong>What it measures:</strong> ${descHtml}<br>
            <strong>Target:</strong> ${kpi.targetPct}
            ${evalNoteHtml}
          </div>
          <div style="flex:1;opacity:0" class="kpi-right">${cols[0]}</div>
          <div style="flex:1;opacity:0" class="kpi-right">${cols[1]}</div>
          <div style="flex:1;opacity:0" class="kpi-right">${cols[2]}</div>
        </div>
        ${explanationHtml}
      </div>
    </div>`;
  }

  // For KPIs with CSC + Scale tables (Social Compliance), use 3-column layout
  const hasManyScoringTables = kpi.scoringCSC && kpi.scoreScale;
  if (hasManyScoringTables) {
    return `
    <div class="slide" id="kpi-${kpi.id}-data" data-animate="kpi-data">
      <div class="kpi-data-slide">
        <div class="kpi-top-bar">
          ${badge}
          <span class="kpi-title">${kpi.name}</span>
          <span class="kpi-lead">Lead: ${kpi.lead}</span>
        </div>
        <div style="display:flex;gap:14px;align-items:flex-start;flex:1;min-height:0">
          <div style="flex:1;display:flex;flex-direction:column;gap:6px;opacity:0" class="kpi-left">
            <div class="kpi-score-display" style="opacity:1;padding:8px">
              <div class="kpi-score-big" style="color:${scoreColor}">${scoreText}<span class="kpi-score-max"> / ${kpi.maxPts}</span></div>
              <div class="kpi-score-label">January 2026 Score</div>
            </div>
            <div class="kpi-desc" style="font-size:11px">
              <strong>What it measures:</strong> ${descHtml}<br>
              <strong>Target:</strong> ${kpi.targetPct}
            </div>
            ${scaleTableHtml}
          </div>
          <div style="flex:1;opacity:0" class="kpi-right">${tableHtml}</div>
          <div style="flex:1;opacity:0" class="kpi-right">${cscTableHtml}</div>
        </div>
      </div>
    </div>`;
  }

  return `
    <div class="slide" id="kpi-${kpi.id}-data" data-animate="kpi-data">
      <div class="kpi-data-slide">
        <div class="kpi-top-bar">
          ${badge}
          <span class="kpi-title">${kpi.name}</span>
          <span class="kpi-lead">Lead: ${kpi.lead}</span>
        </div>
        <div class="kpi-body"${kpi.hideScoring ? ' style="justify-content:center"' : ''}>
          ${kpi.hideScoring ? `
          <div style="flex:1;max-width:800px;display:flex;flex-direction:column;gap:8px;opacity:0" class="kpi-left">
            ${keyLearningHtml}
            ${factoryHtml}
            <div class="kpi-desc" style="font-size:14px">
              <strong>What it measures:</strong> ${descHtml}<br>
              <strong>Target:</strong> ${kpi.targetPct}
            </div>
          </div>
          ` : `
          <div class="kpi-left">
            ${chartHtml}
            ${trendImageHtml}
            ${keyLearningHtml}
            ${monthlyHtml}
            ${factoryHtml}
            ${socialTargetHtml}
            ${subKpiHtml}
            <div class="kpi-desc">
              <strong>What it measures:</strong> ${descHtml}<br>
              <strong>Target:</strong> ${kpi.targetPct}
            </div>
            ${evalNoteHtml}
          </div>
          <div class="kpi-right">
            <div class="kpi-score-display">
              <div class="kpi-score-big" style="color:${scoreColor}">${scoreText}<span class="kpi-score-max"> / ${kpi.maxPts}</span></div>
              <div class="kpi-score-label">January 2026 Score</div>
              ${pctBadges}
            </div>
            ${tableHtml}
          </div>
          `}
        </div>
        ${explanationHtml}
      </div>
    </div>`;
}

// Build HTML for a KPI learning/plan slide (score circles + two cards)
function buildKpiLearningSlide(kpi) {
  if (!kpi.hasLearning) return '';     // skip if no learning data

  const badge = `<span class="kpi-cat-badge" style="background:${kpi.catColor}22;color:${kpi.catColor};border:1px solid ${kpi.catColor}44">${kpi.category}</span>`;

  // Scale label: show old scale if different from new (e.g., "9 / 15" vs "13 / 20")
  const prevLabel = kpi.maxPts2025 !== kpi.maxPts ? `${kpi.endYear2025} / ${kpi.maxPts2025}` : `${kpi.endYear2025}`;
  const nextLabel = `${kpi.target2026} / ${kpi.maxPts}`;

  // Bullet list for key learnings
  const learningItems = kpi.keyLearning.map(item => `<li>${item}</li>`).join('');

  // Bullet list for improvement plan (supports flat array or sectioned object)
  let planItems = '';
  if (Array.isArray(kpi.improvementPlan)) {
    planItems = kpi.improvementPlan.map(item => `<li>${item}</li>`).join('');
  } else if (kpi.improvementPlan && kpi.improvementPlan.sections) {
    kpi.improvementPlan.sections.forEach(sec => {
      planItems += `<li style="list-style:none;font-weight:700;margin-top:6px;color:var(--accent)">${sec.header}</li>`;
      planItems += sec.items.map(item => `<li>${item}</li>`).join('');
    });
  }

  return `
    <div class="slide" id="kpi-${kpi.id}-learning" data-animate="kpi-learning">
      <div class="kpi-learning-slide">
        <div class="kpi-learn-top">
          ${badge}
          <span class="kpi-title">${kpi.name}</span>
        </div>
        <div style="display:flex;align-items:center;gap:32px;">
          <div class="kpi-circle prev">
            <div class="num">${kpi.endYear2025}</div>
            <div class="lbl">End 2025</div>
            <div class="lbl" style="font-size:10px;color:#999">(of ${kpi.maxPts2025} pts)</div>
          </div>
          <div class="kpi-learn-arrow">→</div>
          <div class="kpi-circle next">
            <div class="num">${kpi.target2026}</div>
            <div class="lbl">Target 2026</div>
            <div class="lbl" style="font-size:10px;color:#999">(of ${kpi.maxPts} pts)</div>
          </div>
        </div>
        <div class="kpi-cards">
          <div class="kpi-card learning">
            <h4>📋 Key Learning 2025</h4>
            <ul>${learningItems}</ul>
          </div>
          <div class="kpi-card plan">
            <h4>🎯 Improvement Plan 2026</h4>
            <ul>${planItems}</ul>
          </div>
        </div>
      </div>
    </div>`;
}

// Build HTML for an extra content slide (Key Success, WH Claim, Strategy, Framework, etc.)
function buildKpiExtraSlide(kpi, extra) {
  const badge = `<span class="kpi-cat-badge" style="background:${kpi.catColor}22;color:${kpi.catColor};border:1px solid ${kpi.catColor}44">${kpi.category}</span>`;
  let bodyHtml = '';

  if (extra.type === 'visual') {
    // Image-based slide (Q-KPI dashboards, SPIKE scale, etc.)
    bodyHtml = `
      <div style="text-align:center;margin:4px 0;flex:1;display:flex;align-items:center;justify-content:center">
        <img src="${extra.image}" alt="${extra.title}" style="max-width:100%;max-height:78vh;border-radius:6px;border:1px solid #e0e0e0;box-shadow:0 2px 8px rgba(0,0,0,0.08)">
      </div>`;
    if (extra.caption) {
      bodyHtml += `<div style="text-align:center;font-size:11px;color:#777;margin-top:4px;line-height:1.4">${extra.caption}</div>`;
    }
  }

  else if (extra.type === 'visual-combined') {
    // Combined image layout: first image on top, remaining side by side below
    const imgs = extra.images || [];
    let topImg = '';
    let bottomRow = '';
    if (imgs.length > 0) {
      topImg = `
        <div style="text-align:center;margin-bottom:8px">
          <div style="font-size:13px;font-weight:700;color:#333;margin-bottom:4px;background:#ffeb3b;display:inline-block;padding:2px 12px">${imgs[0].label}</div>
          <img src="${imgs[0].src}" alt="${imgs[0].label}" style="max-width:${imgs[0].width || '55%'};max-height:32vh;border-radius:6px;border:1px solid #e0e0e0;box-shadow:0 2px 8px rgba(0,0,0,0.08)">
        </div>`;
    }
    if (imgs.length > 1) {
      bottomRow = '<div style="display:flex;gap:12px;justify-content:center;align-items:flex-start">';
      for (let i = 1; i < imgs.length; i++) {
        bottomRow += `
          <div style="text-align:center;flex:1;max-width:${imgs[i].width || '48%'}">
            <div style="font-size:12px;font-weight:700;color:#333;margin-bottom:3px;background:#ffeb3b;display:inline-block;padding:1px 10px">${imgs[i].label}</div>
            <img src="${imgs[i].src}" alt="${imgs[i].label}" style="width:100%;max-height:28vh;border-radius:6px;border:1px solid #e0e0e0;box-shadow:0 2px 8px rgba(0,0,0,0.08)">
          </div>`;
      }
      bottomRow += '</div>';
    }
    bodyHtml = topImg + bottomRow;
    if (extra.scaleImage) {
      bodyHtml += `<div style="text-align:center;margin-top:8px"><img src="${extra.scaleImage}" alt="Q-KPI Scale" style="max-width:400px;max-height:80px;border-radius:4px;border:1px solid #e0e0e0"></div>`;
    }
  }

  else if (extra.type === 'key-success') {
    // Achievements list + optional support needed
    const achieveItems = extra.items.map(i => `<li>${i}</li>`).join('');
    let supportHtml = '';
    if (extra.support && extra.support.length > 0) {
      const supportItems = extra.support.map(i => `<li>${i}</li>`).join('');
      supportHtml = `
        <div class="kpi-success-card support">
          <h4>Support Needed from LO Team</h4>
          <ul>${supportItems}</ul>
        </div>`;
    }
    bodyHtml = `
      <div class="kpi-success-grid">
        <div class="kpi-success-card achievements">
          <h4>2025 Key Achievements</h4>
          <ul>${achieveItems}</ul>
        </div>
        ${supportHtml}
      </div>`;
  }

  else if (extra.type === 'content') {
    // Sections with heading + bullet items
    bodyHtml = extra.sections.map(s => {
      const items = s.items.map(i => `<li>${i}</li>`).join('');
      return `
        <div class="kpi-hl-card highlight" style="flex:none;width:100%">
          <h4>${s.heading}</h4>
          <ul>${items}</ul>
        </div>`;
    }).join('');
  }

  else if (extra.type === 'factory-plan') {
    // Factory data table for 2026 plan
    bodyHtml = buildDataTable(extra.factoryData.headers, extra.factoryData.rows);
    if (extra.factoryData.summary) {
      bodyHtml += `<div style="text-align:center;font-size:15px;color:var(--accent);margin-top:10px;font-weight:700">${extra.factoryData.summary}</div>`;
    }
  }

  else if (extra.type === 'strategy') {
    // 2x2 grid of strategy pillars
    bodyHtml = '<div class="kpi-pillar-grid">';
    extra.pillars.forEach(p => {
      const items = p.items.map(i => `<li>${i}</li>`).join('');
      bodyHtml += `
        <div class="kpi-pillar-card">
          <h4 style="color:${p.color}">${p.name}</h4>
          <ul>${items}</ul>
        </div>`;
    });
    bodyHtml += '</div>';
  }

  else if (extra.type === 'plan-strategy-combined') {
    // Combined: score circles + plan table + improvement plan + strategy pillars
    // Score circles (from parent kpi)
    let circlesHtml = '';
    if (kpi.endYear2025 != null && kpi.target2026 != null) {
      circlesHtml = `
        <div style="display:flex;align-items:center;gap:16px;justify-content:center;margin-bottom:8px">
          <div style="width:70px;height:70px;border-radius:50%;border:3px solid #888;display:flex;flex-direction:column;align-items:center;justify-content:center">
            <div style="font-size:20px;font-weight:700;color:#555">${kpi.endYear2025}</div>
            <div style="font-size:8px;color:#888">End 2025</div>
            <div style="font-size:7px;color:#aaa">(of ${kpi.maxPts2025} pts)</div>
          </div>
          <div style="font-size:20px;color:var(--accent);font-weight:700">→</div>
          <div style="width:70px;height:70px;border-radius:50%;border:3px solid var(--green);display:flex;flex-direction:column;align-items:center;justify-content:center">
            <div style="font-size:20px;font-weight:700;color:var(--green)">${kpi.target2026}</div>
            <div style="font-size:8px;color:#888">Target 2026</div>
            <div style="font-size:7px;color:#aaa">(of ${kpi.maxPts} pts)</div>
          </div>
        </div>`;
    }
    // Factory plan table
    let planTableHtml = '';
    if (extra.factoryData) {
      planTableHtml = buildDataTable(extra.factoryData.headers, extra.factoryData.rows);
      if (extra.factoryData.summary) {
        planTableHtml += `<div style="text-align:center;font-size:13px;color:var(--accent);margin-top:6px;font-weight:700">${extra.factoryData.summary}</div>`;
      }
    }
    // Improvement plan bullets (from parent kpi)
    let improvePlanHtml = '';
    if (kpi.improvementPlan && kpi.improvementPlan.length > 0) {
      const planItems = kpi.improvementPlan.map(item => `<li style="font-size:14px;margin-bottom:5px;line-height:1.4">${item}</li>`).join('');
      improvePlanHtml = `
        <div style="background:var(--bg-card);border:1px solid #e0e0e0;border-radius:10px;padding:14px 18px">
          <h4 style="font-size:16px;font-weight:700;color:var(--green);margin-bottom:8px">Improvement Plan 2026</h4>
          <ul style="padding-left:20px;margin:0">${planItems}</ul>
        </div>`;
    }
    // Strategy pillars (2x2 grid)
    let pillarsHtml = '';
    if (extra.pillars) {
      pillarsHtml = '<div class="kpi-pillar-grid" style="gap:10px">';
      extra.pillars.forEach(p => {
        const items = p.items.map(i => `<li style="font-size:13px;margin-bottom:3px">${i}</li>`).join('');
        pillarsHtml += `
          <div class="kpi-pillar-card" style="padding:10px 14px;opacity:1">
            <h4 style="color:${p.color};font-size:15px;margin-bottom:5px">${p.name}</h4>
            <ul>${items}</ul>
          </div>`;
      });
      pillarsHtml += '</div>';
    }
    // Two-column layout: left = circles + plan table, right = improvement plan + strategy pillars
    bodyHtml = `
      <div style="display:flex;gap:18px;flex:1;min-height:0">
        <div style="flex:1;display:flex;flex-direction:column;gap:8px;overflow-y:auto">
          ${circlesHtml}
          ${planTableHtml}
        </div>
        <div style="flex:1;display:flex;flex-direction:column;gap:10px;overflow-y:auto">
          ${improvePlanHtml}
          ${pillarsHtml}
        </div>
      </div>`;
  }

  else if (extra.type === 'framework') {
    // Engineering Solutions framework — multi-area layout
    bodyHtml = '<div class="kpi-pillar-grid">';
    extra.areas.forEach(a => {
      const items = a.items.map(i => `<li>${i}</li>`).join('');
      bodyHtml += `
        <div class="kpi-pillar-card">
          <h4 style="color:${a.color}">${a.name}</h4>
          <div style="font-size:13px;color:var(--text-dim);margin-bottom:6px">${a.subtitle}</div>
          <ul>${items}</ul>
        </div>`;
    });
    bodyHtml += '</div>';
  }

  else if (extra.type === 'framework-table') {
    // Engineering Solutions detailed table with all levels
    const td = extra.tableData;
    // Level descriptions header
    bodyHtml = '<div style="display:flex;gap:12px;margin-bottom:12px;flex-wrap:wrap">';
    td.levelDescriptions.forEach(ld => {
      const scoredStyle = ld.scored
        ? 'background:rgba(230,81,0,0.08);border:1px solid rgba(230,81,0,0.25);color:#e65100'
        : 'background:rgba(0,0,0,0.03);border:1px solid #e0e0e0;color:#888';
      bodyHtml += `<div style="flex:1;min-width:140px;${scoredStyle};border-radius:8px;padding:8px 12px;text-align:center">
        <div style="font-size:14px;font-weight:700">${ld.level}</div>
        <div style="font-size:11px;opacity:0.8">${ld.focus}</div>
        ${ld.scored ? '<div style="font-size:10px;margin-top:2px;opacity:0.7">Scored in 2026</div>' : '<div style="font-size:10px;margin-top:2px;opacity:0.5">Future capability</div>'}
      </div>`;
    });
    bodyHtml += '</div>';
    // Detailed table
    bodyHtml += '<div class="kpi-data-table-wrap"><table class="kpi-data-table"><thead><tr>';
    td.headers.forEach(h => { bodyHtml += `<th>${h}</th>`; });
    bodyHtml += '</tr></thead><tbody>';
    td.rows.forEach(row => {
      const isLevel = row[0] !== '';
      bodyHtml += `<tr${isLevel ? ' style="border-top:2px solid #ccc"' : ''}>`;
      row.forEach((cell, i) => {
        let style = '';
        if (i === 0 && cell) style = ' style="font-weight:700;color:#e65100"';
        if (i === 1 && cell) style = ' style="text-align:center;font-weight:700;color:var(--accent)"';
        if (i === 2) style = ' style="font-weight:600"';
        bodyHtml += `<td${style}>${cell}</td>`;
      });
      bodyHtml += '</tr>';
    });
    bodyHtml += '</tbody></table></div>';
  }

  else if (extra.type === 'factory-results') {
    // Factory results table (e.g. Social Compliance 2025 S-KPI results)
    bodyHtml = buildDataTable(extra.factoryData.headers, extra.factoryData.rows);
    if (extra.factoryData.summary) {
      bodyHtml += `<div style="text-align:center;font-size:18px;color:var(--accent);margin-top:12px;font-weight:700">${extra.factoryData.summary}</div>`;
    }
  }

  else if (extra.type === 'target-results') {
    // Target table + January results table (Social Compliance 2026)
    bodyHtml = '<h4 style="color:#1a1a1a;font-size:18px;margin-bottom:8px">2026 SI-KPI Target by Factory</h4>';
    bodyHtml += buildDataTable(extra.targetTable.headers, extra.targetTable.rows);
    if (extra.targetTable.summary) {
      bodyHtml += `<div style="text-align:center;font-size:15px;color:var(--accent);margin-top:8px;font-weight:600">${extra.targetTable.summary}</div>`;
    }
    bodyHtml += '<h4 style="color:#1a1a1a;font-size:18px;margin:20px 0 8px 0">January 2026 Results</h4>';
    bodyHtml += buildDataTable(extra.janResults.headers, extra.janResults.rows);
    if (extra.janResults.summary) {
      bodyHtml += `<div style="text-align:center;font-size:14px;color:var(--yellow);margin-top:8px;font-style:italic">${extra.janResults.summary}</div>`;
    }
  }

  else if (extra.type === 'comparison') {
    // Year-over-year comparison table + highlight/lowlight cards
    bodyHtml = buildDataTable(extra.factoryData.headers, extra.factoryData.rows);
    // Highlight and lowlight cards
    const hlItems = extra.highlights ? extra.highlights.map(i => `<li>${i}</li>`).join('') : '';
    const llItems = extra.lowlights ? extra.lowlights.map(i => `<li>${i}</li>`).join('') : '';
    bodyHtml += `
      <div class="kpi-hl-grid" style="margin-top:16px">
        <div class="kpi-hl-card highlight">
          <h4>Highlights</h4>
          <ul>${hlItems}</ul>
        </div>
        <div class="kpi-hl-card lowlight">
          <h4>Areas to Improve</h4>
          <ul>${llItems}</ul>
        </div>
      </div>`;
  }

  return `
    <div class="slide" data-animate="kpi-extra">
      <div class="kpi-extra-slide">
        <div style="display:flex;align-items:center;gap:12px">
          ${badge}
          <div class="kpi-extra-title">${extra.title}</div>
        </div>
        ${bodyHtml}
      </div>
    </div>`;
}

// =============================================
// INJECT CHARTS INTO THE DOM
// =============================================

// Map category names to color classes (matches by the first word)
const catColorMap = {
  'Agile':       'fw-cat-agile',
  'Competitive': 'fw-cat-competitive',
  'ESG':         'fw-cat-esg',
  'Quality':     'fw-cat-quality',
  'Competency':  'fw-cat-competency',
};

// Helper: build a category label row for bar charts
function buildCatLabel(catName) {
  // Find matching color by checking if the label starts with a known category name
  const key = Object.keys(catColorMap).find(k => catName.startsWith(k)) || '';
  const cls = key ? catColorMap[key] : '';
  return `<div class="bar-cat-label ${cls}">${catName}</div>`;
}

// Slide 2: 2024 chart
const chart2024El = document.getElementById('chart2024');
data2024.forEach(([label, max, score, cat]) => {
  if (cat) chart2024El.innerHTML += buildCatLabel(cat);   // insert category header
  chart2024El.innerHTML += buildBarRow(label, max, score);
});

// Slide 3: 2025 chart
const chart2025El = document.getElementById('chart2025');
data2025.forEach(([label, max, score, change, cat]) => {
  if (cat) chart2025El.innerHTML += buildCatLabel(cat);   // insert category header
  let extra = '';
  if (change > 0) extra = 'bar-improved';
  else if (change < 0) extra = 'bar-declined';
  chart2025El.innerHTML += buildBarRow(label, max, score, extra);
});

// Slide 3: callouts
const callouts3El = document.getElementById('callouts3');
callouts.forEach(c => {
  callouts3El.innerHTML += `
    <div class="callout">
      <div class="label">${c.label}</div>
      <div class="change ${c.cls}">${c.val}</div>
    </div>`;
});

// Slide 4: weight overview chart
const weightChartEl = document.getElementById('weight-chart');
weightData.forEach(w => {
  // Calculate bar width as percentage (30% = full width)
  const fromPct = (w.from / 30) * 100;       // 2025 bar width
  const toPct = (w.to / 30) * 100;           // 2026 bar width (used later in animation)
  const diff = w.to - w.from;                // change amount
  // Determine badge text and color class
  let badgeText, badgeCls;
  if (diff > 0)      { badgeText = '+' + diff + '%'; badgeCls = 'up'; }
  else if (diff < 0) { badgeText = diff + '%';       badgeCls = 'down'; }
  else               { badgeText = 'No change';      badgeCls = 'same'; }
  weightChartEl.innerHTML += `
    <div class="weight-row">
      <div class="weight-label ${w.labelCls}">${w.name}</div>
      <div class="weight-track">
        <div class="weight-bar ${w.barCls}" data-from="${fromPct}" data-to="${toPct}" style="width:0%">
          <span class="weight-pct">${w.from}%</span>
        </div>
      </div>
      <div class="weight-change-badge ${badgeCls}" data-text="${badgeText}">${badgeText}</div>
    </div>`;
});

// Slide 5: render paired framework rows
// Helper: build HTML for one item card, or an empty placeholder
function fwItemHtml(item) {
  if (!item) return '<div class="fw-empty"></div>';
  const descHtml = item.desc ? `<div class="fw-desc">${item.desc}</div>` : '';
  return `
    <div class="fw-item ${item.cls}">
      <div class="fw-item-left">
        <span>${item.name}</span>
        ${descHtml}
      </div>
      <span class="pts">${item.pts} pts</span>
    </div>`;
}

const fwRowsEl = document.getElementById('fw-rows');
fwGroups.forEach(group => {
  // 1) Category header row — left label | empty | right label
  fwRowsEl.innerHTML += `
    <div class="fw-row cat-row">
      <div class="fw-row-left"><div class="fw-cat-label ${group.catCls}">${group.catLeft}</div></div>
      <div class="fw-row-arrow"></div>
      <div class="fw-row-right"><div class="fw-cat-label ${group.catCls}">${group.catRight}</div></div>
    </div>`;

  // 2) Item rows — pair left[i] with right[i], use arrow between them
  const maxRows = Math.max(group.left.length, group.right.length);
  for (let i = 0; i < maxRows; i++) {
    const leftItem  = i < group.left.length  ? group.left[i]  : null;
    const rightItem = i < group.right.length ? group.right[i] : null;
    fwRowsEl.innerHTML += `
      <div class="fw-row">
        <div class="fw-row-left">${fwItemHtml(leftItem)}</div>
        <div class="fw-row-arrow">→</div>
        <div class="fw-row-right">${fwItemHtml(rightItem)}</div>
      </div>`;
  }
});

// Slide 5: 2026 January chart
const chart2026El = document.getElementById('chart2026');
data2026.forEach(([label, max, target, jan, note, cat]) => {
  if (cat) chart2026El.innerHTML += buildCatLabel(cat);   // insert category header
  chart2026El.innerHTML += buildBarRow2026(label, max, target, jan, note);
});

// Slide 6: gap table
const gapTableBody = document.querySelector('#gap-table tbody');
gapData.forEach(([cat, cur, tgt, gap]) => {
  gapTableBody.innerHTML += `
    <tr>
      <td>${cat}</td>
      <td>${cur}</td>
      <td>${tgt}</td>
      <td class="plus">+${gap}</td>
    </tr>`;
});

// =============================================
// INJECT KPI DETAIL SLIDES INTO THE DOM
// =============================================

// We insert KPI slides after slide5 (framework detail) and before slide6 (January 2026).
// Each category gets: 1 header slide, then data + learning slides for each KPI.
const slide5El = document.getElementById('slide5');   // the framework detail slide
let insertAfter = slide5El;                           // tracks where to insert next

// Helper: insert a slide HTML string after a given element
function insertSlideAfter(refEl, html) {
  refEl.insertAdjacentHTML('afterend', html);         // add HTML right after the reference element
  return refEl.nextElementSibling;                    // return the newly created element
}

// Loop through each category and its KPIs
categoryHeaders.forEach(cat => {
  // 1) Insert category header slide
  insertAfter = insertSlideAfter(insertAfter, buildCategoryHeaderSlide(cat));

  // 2) Insert data + learning slides for each KPI in this category
  const catKpis = kpiData.filter(k => k.category === cat.name);
  catKpis.forEach(kpi => {
    // Data slide (always)
    insertAfter = insertSlideAfter(insertAfter, buildKpiDataSlide(kpi));
    // Learning slide (only if this KPI has learning data)
    if (kpi.hasLearning) {
      insertAfter = insertSlideAfter(insertAfter, buildKpiLearningSlide(kpi));
    }
    // Extra slides (Key Success, WH Claim, Strategy, Framework, etc.)
    if (kpi.extraSlides) {
      kpi.extraSlides.forEach(extra => {
        insertAfter = insertSlideAfter(insertAfter, buildKpiExtraSlide(kpi, extra));
      });
    }
  });
});

// =============================================
// SLIDE NAVIGATION
// =============================================

let currentSlide = 1;       // start on slide 1

// Collect ALL slides in DOM order (existing + newly injected KPI slides)
const slides = Array.from(document.querySelectorAll('.slide'));
const totalSlides = slides.length;

const counterEl = document.getElementById('slide-counter');

// Go to a specific slide number (1-based)
function goToSlide(n) {
  if (n < 1 || n > totalSlides) return;   // don't go out of bounds
  // Hide all slides
  slides.forEach(s => s.classList.remove('active'));
  // Show target slide
  slides[n - 1].classList.add('active');
  currentSlide = n;
  counterEl.textContent = n + ' / ' + totalSlides;
  // Run entry animations for this slide
  animateSlide(n);
}

// Advance to next slide
function nextSlide() { goToSlide(currentSlide + 1); }

// Go back one slide
function prevSlide() { goToSlide(currentSlide - 1); }

// Listen for clicks (anywhere) to advance
document.addEventListener('click', (e) => {
  // Ignore if clicking on the nav hint area (bottom strip)
  if (e.clientY > window.innerHeight - 60 && e.clientX > window.innerWidth - 300) return;
  nextSlide();
});

// Listen for keyboard: → / Space = next, ← = previous
document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowRight' || e.key === ' ') {
    e.preventDefault();
    nextSlide();
  } else if (e.key === 'ArrowLeft') {
    e.preventDefault();
    prevSlide();
  }
});

// =============================================
// ANIMATIONS FOR EACH SLIDE
// =============================================

// Track which slides have already been animated so we don't repeat
const animated = {};

function animateSlide(n) {
  if (animated[n]) return;     // only animate once
  animated[n] = true;

  // Get the actual slide element for this position
  const slideEl = slides[n - 1];
  const slideId = slideEl.id;

  // Dispatch animation based on slide ID or data-animate attribute
  // Original hardcoded slides use their fixed IDs
  if (slideId === 'slide1') animateSlide1();
  else if (slideId === 'slide2') animateSlide2();
  else if (slideId === 'slide3') animateSlide3();
  else if (slideId === 'slide4') animateSlide4();
  else if (slideId === 'slide5') animateSlide5();
  else if (slideId === 'slide6') animateSlide6();
  else if (slideId === 'slide7') animateSlide7();
  else if (slideId === 'slide8') animateSlide8();
  // Dynamically generated KPI slides use data-animate attribute
  else if (slideEl.dataset.animate === 'kpi-data') animateKpiDataSlide(slideEl);
  else if (slideEl.dataset.animate === 'kpi-learning') animateKpiLearningSlide(slideEl);
  else if (slideEl.dataset.animate === 'kpi-category') animateKpiCategorySlide(slideEl);
  else if (slideEl.dataset.animate === 'kpi-extra') animateKpiExtraSlide(slideEl);
}

// ----- SLIDE 1: Title -----
function animateSlide1() {
  const logoRow = document.getElementById('logo-row');
  const stripes = document.getElementById('stripes');
  const title   = document.getElementById('title-text');
  const sub     = document.getElementById('subtitle-text');

  // Animate logos first
  setTimeout(() => {
    logoRow.style.animation = 'fadeIn 0.6s ease forwards';
  }, 100);

  // Animate stripes
  setTimeout(() => {
    stripes.style.opacity = '1';
    stripes.style.animation = 'fadeInUp 0.6s ease forwards';
  }, 300);

  // Then title
  setTimeout(() => {
    title.style.animation = 'fadeInUp 0.8s ease forwards';
  }, 700);

  // Then subtitle
  setTimeout(() => {
    sub.style.animation = 'fadeIn 0.8s ease forwards';
  }, 1300);
}

// ----- SLIDE 2: 2024 chart -----
function animateSlide2() {
  const title = document.getElementById('s2-title');
  const score = document.getElementById('s2-score');
  const rank  = document.getElementById('s2-rank');

  setTimeout(() => { title.style.animation = 'fadeInUp 0.5s ease forwards'; }, 100);
  setTimeout(() => { score.style.animation = 'countUp 0.5s ease forwards'; }, 400);
  setTimeout(() => { rank.style.animation  = 'fadeIn 0.4s ease forwards'; }, 600);

  // Animate category labels and bar rows together
  const allItems = document.querySelectorAll('#chart2024 .bar-cat-label, #chart2024 .bar-row');
  allItems.forEach((el, i) => {
    setTimeout(() => {
      el.style.animation = 'fadeInUp 0.4s ease forwards';
      // Also grow the bar fill if this is a bar row
      const fill = el.querySelector('.bar-fill');
      if (fill) {
        fill.style.width = fill.dataset.width + '%';
      }
    }, 700 + i * 100);
  });
}

// ----- SLIDE 3: 2025 chart -----
function animateSlide3() {
  const title  = document.getElementById('s3-title');
  const score  = document.getElementById('s3-score');
  const rank   = document.getElementById('s3-rank');
  const change = document.getElementById('s3-change');

  setTimeout(() => { title.style.animation = 'fadeInUp 0.5s ease forwards'; }, 100);
  setTimeout(() => { score.style.animation = 'countUp 0.5s ease forwards'; }, 400);
  setTimeout(() => { rank.style.animation  = 'fadeIn 0.4s ease forwards'; }, 600);
  setTimeout(() => { change.style.animation = 'popIn 0.4s ease forwards'; }, 900);

  // Animate category labels and bars together
  const allItems = document.querySelectorAll('#chart2025 .bar-cat-label, #chart2025 .bar-row');
  allItems.forEach((el, i) => {
    setTimeout(() => {
      el.style.animation = 'fadeInUp 0.4s ease forwards';
      const fill = el.querySelector('.bar-fill');
      if (fill) fill.style.width = fill.dataset.width + '%';
    }, 1000 + i * 100);
  });

  // Animate callouts
  const couts = document.querySelectorAll('#callouts3 .callout');
  couts.forEach((c, i) => {
    setTimeout(() => {
      c.style.animation = 'popIn 0.3s ease forwards';
    }, 2200 + i * 150);
  });
}

// ----- SLIDE 4: Weight overview -----
function animateSlide4() {
  const title = document.getElementById('s4-title');
  setTimeout(() => { title.style.animation = 'fadeInUp 0.5s ease forwards'; }, 100);

  // Show each weight row one by one, with bars at 2025 width
  const rows = document.querySelectorAll('#weight-chart .weight-row');
  rows.forEach((row, i) => {
    setTimeout(() => {
      row.style.animation = 'fadeInUp 0.4s ease forwards';
      // Set bar to 2025 width
      const bar = row.querySelector('.weight-bar');
      if (bar) bar.style.width = bar.dataset.from + '%';
    }, 400 + i * 200);
  });

  // After all rows are visible, animate bars to 2026 widths
  const transitionDelay = 400 + rows.length * 200 + 800;
  setTimeout(() => {
    rows.forEach(row => {
      const bar = row.querySelector('.weight-bar');
      if (bar) {
        // Update the percentage text to show 2026 value
        const pctEl = bar.querySelector('.weight-pct');
        // Convert bar width back to actual percentage (30% scale)
        const toPercent = Math.round(parseFloat(bar.dataset.to) / 100 * 30);
        if (pctEl) pctEl.textContent = toPercent + '%';
        bar.style.width = bar.dataset.to + '%';
      }
    });
  }, transitionDelay);

  // Pop in the change badges after bars finish moving
  const badgeDelay = transitionDelay + 1400;
  rows.forEach((row, i) => {
    const badge = row.querySelector('.weight-change-badge');
    if (badge) {
      setTimeout(() => {
        badge.style.animation = 'popIn 0.3s ease forwards';
      }, badgeDelay + i * 150);
    }
  });

  // Show the bottom note
  const note = document.getElementById('weight-note');
  setTimeout(() => { note.style.animation = 'fadeIn 0.5s ease forwards'; }, badgeDelay + rows.length * 150 + 200);
}

// ----- SLIDE 5: Framework changes -----
function animateSlide5() {
  const title = document.getElementById('s5-title');
  setTimeout(() => { title.style.animation = 'fadeInUp 0.5s ease forwards'; }, 100);

  // Column headers
  const leftTitle = document.getElementById('fw-title-left');
  const rightTitle = document.getElementById('fw-title-right');
  setTimeout(() => { leftTitle.style.animation = 'slideInLeft 0.4s ease forwards'; }, 200);
  setTimeout(() => { rightTitle.style.animation = 'slideInRight 0.4s ease forwards'; }, 200);

  // Animate each paired row one by one
  const allRows = document.querySelectorAll('#fw-rows .fw-row');
  allRows.forEach((row, i) => {
    setTimeout(() => {
      row.style.animation = 'fadeInUp 0.35s ease forwards';
    }, 500 + i * 100);
  });

  // Structure badges
  const totalRows = allRows.length;
  const badgeDelay = 500 + totalRows * 100 + 200;
  const badges = document.querySelectorAll('#struct-badges .struct-badge');
  badges.forEach((b, i) => {
    setTimeout(() => { b.style.animation = 'popIn 0.4s ease forwards'; }, badgeDelay + i * 200);
  });

  // Note
  const note = document.getElementById('fw-note');
  setTimeout(() => { note.style.animation = 'fadeIn 0.5s ease forwards'; }, badgeDelay + 500);
}

// ----- SLIDE 6: January 2026 -----
function animateSlide6() {
  const title = document.getElementById('s6-title');
  const score = document.getElementById('s6-score');
  const rank  = document.getElementById('s6-rank');

  setTimeout(() => { title.style.animation = 'fadeInUp 0.5s ease forwards'; }, 100);
  setTimeout(() => { score.style.animation = 'countUp 0.5s ease forwards'; }, 400);
  setTimeout(() => { rank.style.animation  = 'fadeIn 0.4s ease forwards'; }, 600);

  const allItems = document.querySelectorAll('#chart2026 .bar-cat-label, #chart2026 .bar-row');
  allItems.forEach((el, i) => {
    setTimeout(() => {
      el.style.animation = 'fadeInUp 0.4s ease forwards';
      const fill = el.querySelector('.bar-fill');
      if (fill) fill.style.width = fill.dataset.width + '%';
    }, 700 + i * 100);
  });
}

// ----- SLIDE 7: Road to #1 -----
function animateSlide7() {
  const title = document.getElementById('s7-title');
  setTimeout(() => { title.style.animation = 'fadeInUp 0.5s ease forwards'; }, 100);

  setTimeout(() => {
    document.getElementById('s7-current').style.animation = 'countUp 0.6s ease forwards';
  }, 400);
  setTimeout(() => {
    document.getElementById('s7-arrow').style.animation = 'fadeIn 0.4s ease forwards';
  }, 800);
  setTimeout(() => {
    document.getElementById('s7-target').style.animation = 'countUp 0.6s ease forwards';
  }, 1000);
  setTimeout(() => {
    document.getElementById('s7-gap').style.animation = 'popIn 0.5s ease forwards';
  }, 1400);
  setTimeout(() => {
    document.getElementById('s7-rankgoal').style.animation = 'fadeInUp 0.5s ease forwards';
  }, 1800);

  // Table rows
  const trows = document.querySelectorAll('#gap-table tbody tr');
  trows.forEach((row, i) => {
    setTimeout(() => {
      row.style.animation = 'fadeInUp 0.3s ease forwards';
    }, 2200 + i * 150);
  });
}

// ----- SLIDE 8: Summary timeline -----
function animateSlide8() {
  const nodes = document.querySelectorAll('.timeline-node');
  const fill1 = document.getElementById('tl-fill1');
  const fill2 = document.getElementById('tl-fill2');
  const msg   = document.getElementById('key-msg');
  const sub   = document.getElementById('closing-sub');

  // First node (2024)
  setTimeout(() => { nodes[0].style.animation = 'countUp 0.5s ease forwards'; }, 300);
  // Line 1 fills
  setTimeout(() => { fill1.style.width = '100%'; }, 800);
  // Second node (2025)
  setTimeout(() => { nodes[1].style.animation = 'countUp 0.5s ease forwards'; }, 1400);
  // Line 2 fills
  setTimeout(() => { fill2.style.width = '100%'; }, 1900);
  // Third node (2026)
  setTimeout(() => { nodes[2].style.animation = 'countUp 0.5s ease forwards'; }, 2500);
  // Key message
  setTimeout(() => { msg.style.animation = 'fadeInUp 0.6s ease forwards'; }, 3200);
  // Closing subtitle
  setTimeout(() => { sub.style.animation = 'fadeIn 0.5s ease forwards'; }, 3800);
}

// ----- KPI CATEGORY HEADER SLIDE -----
function animateKpiCategorySlide(el) {
  // Animate the category name (large colored text)
  const name = el.querySelector('.kpi-cat-name');
  setTimeout(() => { name.style.animation = 'fadeInUp 0.6s ease forwards'; }, 200);

  // Animate the points subtitle
  const pts = el.querySelector('.kpi-cat-pts');
  setTimeout(() => { pts.style.animation = 'fadeIn 0.4s ease forwards'; }, 600);

  // Stagger-reveal each KPI list item
  const items = el.querySelectorAll('.kpi-cat-list li');
  items.forEach((item, i) => {
    setTimeout(() => { item.style.animation = 'popIn 0.3s ease forwards'; }, 800 + i * 150);
  });
}

// ----- KPI DATA SLIDE -----
function animateKpiDataSlide(el) {
  // 1) Fade in the top bar (category badge + title + lead)
  const topBar = el.querySelector('.kpi-top-bar');
  setTimeout(() => { topBar.style.animation = 'fadeInUp 0.5s ease forwards'; }, 100);

  // 2) Slide in the left column (chart + description)
  const left = el.querySelector('.kpi-left');
  if (left) {
    setTimeout(() => { left.style.animation = 'slideInLeft 0.5s ease forwards'; }, 400);
  }

  // 3) Slide in the right column(s) (score + scoring table)
  const rights = el.querySelectorAll('.kpi-right');
  rights.forEach((right, i) => {
    setTimeout(() => { right.style.animation = 'slideInRight 0.5s ease forwards'; }, 400 + i * 200);
  });

  // 4) Pop in the score display
  const scoreDisplay = el.querySelector('.kpi-score-display');
  if (scoreDisplay) {
    setTimeout(() => { scoreDisplay.style.animation = 'popIn 0.4s ease forwards'; }, 900);
  }

  // 5) Fade in the kpi-desc in multi-column layout
  const desc = el.querySelector('.kpi-desc');
  if (desc && desc.parentElement && !desc.closest('.kpi-left')) {
    setTimeout(() => { desc.style.animation = 'fadeInUp 0.5s ease forwards'; }, 300);
  }
}

// ----- KPI LEARNING / PLAN SLIDE -----
function animateKpiLearningSlide(el) {
  // 1) Fade in the top bar (badge + title)
  const topBar = el.querySelector('.kpi-learn-top');
  setTimeout(() => { topBar.style.animation = 'fadeInUp 0.5s ease forwards'; }, 100);

  // 2) Pop in the 2025 score circle
  const prevCircle = el.querySelector('.kpi-circle.prev');
  if (prevCircle) {
    setTimeout(() => { prevCircle.style.animation = 'countUp 0.5s ease forwards'; }, 400);
  }

  // 3) Fade in the arrow between circles
  const arrow = el.querySelector('.kpi-learn-arrow');
  if (arrow) {
    setTimeout(() => { arrow.style.animation = 'fadeIn 0.3s ease forwards'; }, 700);
  }

  // 4) Pop in the 2026 target circle
  const nextCircle = el.querySelector('.kpi-circle.next');
  if (nextCircle) {
    setTimeout(() => { nextCircle.style.animation = 'countUp 0.5s ease forwards'; }, 900);
  }

  // 5) Slide in the learning card from the left
  const learningCard = el.querySelector('.kpi-card.learning');
  if (learningCard) {
    setTimeout(() => { learningCard.style.animation = 'slideInLeft 0.5s ease forwards'; }, 1200);
  }

  // 6) Slide in the plan card from the right
  const planCard = el.querySelector('.kpi-card.plan');
  if (planCard) {
    setTimeout(() => { planCard.style.animation = 'slideInRight 0.5s ease forwards'; }, 1400);
  }
}

// ----- KPI EXTRA SLIDE (Key Success, WH Claim, Strategy, Framework) -----
function animateKpiExtraSlide(el) {
  // 1) Fade in the title bar
  const title = el.querySelector('.kpi-extra-title');
  if (title) {
    setTimeout(() => { title.style.animation = 'fadeInUp 0.5s ease forwards'; }, 100);
  }

  // 2) Stagger-reveal cards/grids
  const cards = el.querySelectorAll('.kpi-success-card, .kpi-pillar-card, .kpi-hl-card');
  cards.forEach((card, i) => {
    setTimeout(() => { card.style.animation = 'fadeInUp 0.4s ease forwards'; }, 400 + i * 200);
  });
}

// =============================================
// INITIAL SETUP
// =============================================

// Update the slide counter to show actual total
counterEl.textContent = '1 / ' + totalSlides;

// Animate slide 1 on page load
animateSlide(1);

</script>
</body>
</html>
